<!DOCTYPE html>
<html>
  <head>
    <title>Sinyaller, Geriye Dönük Analiz, Performans
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
   <script type="text/javascript"
       src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
   </script>
   <script async="async" data-cfasync="false" src="//pl22489825.profitablegatecpm.com/d84f574876e65b2d8f0c7bae784c22b3/invoke.js"></script>

<p><link rel="stylesheet" type="text/css" media="screen" href="https://burakbayramli.github.io/css/style.css">
  </head>
    <body>
      <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">
            <a href="https://burakbayramli.github.io" style="text-decoration:none; color:inherit;">dersblog</a>
          </h1>
          <h2 id="project_tagline"></h2>        <br />
        </header>
      </div>
      <div id="main_content_wrap" class="outer">      <br />
        <section id="main_content" class="inner">
        <h1>Sinyaller, Geriye Dönük Analiz, Performans
</h1></p>
<p>Elimizde bir zaman serisi var, bu seri bir finansal varlığın fiyat seviyesi
olabilir, belki Apple senedidir, ilk gün 100 ikinci gün 102 olmuş, böyle
gidiyor.</p>
<pre><code class="python">import pandas as pd
d = np.array([100,102,104.04,106.12,108.24,110.41])
</code></pre>

<p>Peki bu fiyat seviyeleri günlük hangi yüzde değişimlerine tekabül ediyor?
Bu hesabın bir yolu var, <code>pct_change</code> kullanabiliriz,</p>
<pre><code class="python">p = pd.Series(d)
print (list(p))
print (list(np.round(p.pct_change(),2)))
</code></pre>

<pre><code>[100.0, 102.0, 104.04, 106.12, 108.24, 110.41]
[nan, 0.02, 0.02, 0.02, 0.02, 0.02]
</code></pre>

<p>Her gün yüzde 2'lik bir değişim varmış (bu yazı için veri uydururken sayıları
ona göre ayarladık).</p>
<p>Şimdi sadece yüzde değişimleri ve başlangıç fiyat seviyesini kullanarak seriyi
tekrar üretebilir miydik? Tek yüzde değişimle bir sonraki sayıyı nasıl elde
ederiz?  Mesela 100'den yüzde 2 değişimle sonraki değere geçeceğiz, kolay, 1
artı 0.02 yani 1.02 değerini 100 ile çarparız, sonraki sayı çıkar, 102. Bu
metotu diğer yüzde değişimler için kullanabiliriz. O zaman tüm fiyat
seviyelerini hesap için eldeki yüzde değişim listesine 1 sayısını eklersek,
1.02, 1.02, .. elde edilir, ve bu rakamları başta 100 ile, sonra birbirleri ile
çarparsak tüm fiyat listesini tekrar elde ederiz. Bir dizinin tüm öğelerinin
birer birer çarpılıp bunun kümülatif olarak gösterilmesini <code>cumprod</code>
halleder,</p>
<pre><code class="python">ret = p.pct_change()
100*np.cumprod(1+ret)
</code></pre>

<pre><code>Out[1]: 
0       NaN
1    102.00
2    104.04
3    106.12
4    108.24
5    110.41
dtype: float64
</code></pre>

<p>Üstteki hesabı bir al-tut stratejisinin performansı olarak ta görebiliriz bu
durumda illa baştaki 100 değerini kullanmaya gerek yok, 100 yerine 1 dersek o
zaman bu stratejiye koyulmuş 1 liranın, 1 doların ne kadar büyüyeceğini görmüş
oluruz.  1 lira 2 lira olduysa mesela bu ikiye katlama demektir, performansın
iyi olduğu sonucuna varabiliriz.</p>
<pre><code class="python">1*np.cumprod(1+ret)
</code></pre>

<pre><code>Out[1]: 
0       NaN
1    1.0200
2    1.0404
3    1.0612
4    1.0824
5    1.1041
dtype: float64
</code></pre>

<p>Yüzde değişimler, kumulatif çarpımlar ile uğraşmamızın bir sebebi var, portföy
perfomansına bakarken herhangi bir strateji için gereken alım / satım
"sinyallerini" kolayca dahil edebiliyoruz, ve stratejiyi tartarken bir zaman
serisi üzerinden bunu yapabiliyoruz. Elde edilecek serinin istatistiki,
matematiksel özellikleri vardır, ve bu özellikleri ek özet irdelemeler
faydalı olur, mesela Sharpe oranı gibi.</p>
<p>Sinyalleri şöyle kullanabiliriz, bir varlığı belli bir zaman noktasında almış
olmak 1 sinyali ile temsil edilir, varlığın elde olmaması ise 0 ile temsil
edilir.  O zaman kumulatif hesaptan önce tüm yüzde değişimleri sinyal vektörü
ile çarparız, ondan sonra kumulatif hesap devreye girer. Eğer sinyal 1 ise o
noktada yüzde değişim sıfıra iner, o getiri elde edilmemiş olur, kumulatif
hesapta 1+0 = 1, yani hiç bir değişim yaratmaz. Eğer sinyal 1 ise 1 çarpı mesela
yüzde 2 getiri yüzde 2 getirinin aktif olmuş olması demektir, o getiri kumulatif
çarpıma etki eder.</p>
<pre><code class="python">signal = pd.Series(np.array([1,1,1,1,0,1]))
ret*signal
</code></pre>

<pre><code>Out[1]: 
0         NaN
1    0.020000
2    0.020000
3    0.019992
4    0.000000
5    0.020048
dtype: float64
</code></pre>

<pre><code class="python">signal = pd.Series(np.array([1,1,1,1,0,1]))
1*np.cumprod(1+(ret*signal))
</code></pre>

<pre><code>Out[1]: 
0         NaN
1    1.020000
2    1.040400
3    1.061200
4    1.061200
5    1.082475
dtype: float64
</code></pre>

<p>Örnek</p>
<p>Apple senedine bakalım,</p>
<pre><code class="python">import pandas as pd
df = pd.read_csv('../tser_008_data/AAPL.csv',index_col='Date',parse_dates=True)
df.plot()
plt.savefig('tser_011_sign_01.jpg')
</code></pre>

<p><img alt="" src="tser_011_sign_01.jpg" /></p>
<p>Diyelim ki müneccim bir yatırımcı bu senede ne zaman alıp, satacağını bir
şekilde biliyor. O 2005-06 civarındaki çıkış öncesi alıyor, o çıkışın tepesinde
satıyor, sonra 2006-09'da tekrar geliyor, ve son düşüş öncesi yine çıkıyor.  Bu
arkadaşın alım / satım stratejisini 1 ve 0 sinyalleri ile temsil edebiliriz.</p>
<pre><code class="python">df['signal'] = 0
filt1 = (df.index &gt; '2005-06-01') &amp; (df.index &lt; '2006-02-01')
df.loc[filt1,'signal'] = 1
filt2 = (df.index &gt; '2006-09-01') &amp; (df.index &lt; '2007-01-01')
df.loc[filt2,'signal'] = 1
</code></pre>

<p>Stratejinin başarısı ne olur acaba?</p>
<pre><code class="python">df['ret'] = df.AAPL.pct_change()
cumret = np.cumprod(1+(df.ret*df.signal))
print (cumret.tail(4))
</code></pre>

<pre><code>Date
2006-12-26    2.233475
2006-12-27    2.233750
2006-12-28    2.215938
2006-12-29    2.324721
dtype: float64
</code></pre>

<p>Tüm kumulatif seriye aslında ihtiyaç yok, son gelinen getiri noktası için,</p>
<pre><code class="python">np.prod(1+(df.ret*df.signal))
</code></pre>

<pre><code>Out[1]: 2.3247214450625857
</code></pre>

<p>Yüzde 232 gibi bir artış var! Bu stratejiyi yıllık kazanca nasıl çeviririz?
Eldeki getirinin hangi zaman dilimine tekabül ettiğine bakarız, ve bu getiriyi
bir sene, yani 252 zaman dilimi (yıl içindeki iş günü miktarı), için
ölçekleriz. Mesela eğer 50 gün için bir getiri $g$ hesaplamışsak, bu getiriyi
yukarı ölçekleyip kabaca $g^5$ hesaplayabiliriz ve getiriyi tüm sene bazına
yukarı ölçekleyebiliriz (çünkü $252/5 \approx 5$), sonra tüm sonuçtan bir
çıkartırız daha önce eklenen 1 etkisini iptal etmek için. Eğer eldeki zaman
serisi miktarı 252'den fazla ise alta ölçekleme de yapılabilirdi, $g^{1/2}$,
$g^{1/5}$ gibi, ama bu hesaplar da yine matematiksel olarak doğrudur. Elde
edilecek olan yıllık yüzde oranı (annual percentage rate), APR,</p>
<pre><code class="python">print ('APR', ((np.prod(1.+df.ret*df.signal))**(252./len(df.ret)))-1)
</code></pre>

<pre><code>APR 0.32471861974412564
</code></pre>

<p>Getiri yıllık yüzde 32.47.</p>
<p>Eğer strateji üstteki kadar iyi olmasaydı, mesela yatırımcı 2005-06'da
alım yapmış ama senette kalmış, sona kadar satmamış, bu durumda,</p>
<pre><code class="python">df = pd.read_csv('../tser_008_data/AAPL.csv',index_col='Date',parse_dates=True)
df['signal'] = 0
filt1 = (df.index &gt; '2005-06-01')
df.loc[filt1,'signal'] = 1
df['ret'] = df.AAPL.pct_change()
print (np.prod(1+(df.ret*df.signal)))
print ('APR', ((np.prod(1.+df.ret*df.signal))**(252./len(df.ret)))-1)
</code></pre>

<pre><code>2.105210500206348
APR 0.2816374105511763
</code></pre>

<p>Daha düşük bir getiri elde etmiş olacaktı.</p>
<p>[devam edecek]</p>
          <div id="container-d84f574876e65b2d8f0c7bae784c22b3"></div>

          <br/><a href="../index.html">Yukarı</a>
        </section>          
      </div>
    </body>
</html>
