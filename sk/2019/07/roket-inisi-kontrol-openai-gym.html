<h1>Roket İnişi, Kontrol, OpenAI Gym</h1>
<p>OpenAİ Gym altyapısı altında paylaşılan simülatörlerden biri aya iniş
(lunar lander), bir diğeri, yine Gym altyapısı üzerinde yazılmış ama
ayrı bir proje, rocket-lander. Her iki proje her ne kadar takviyeli
öğrenim / yapay zeka için yazılmış olsa da, (matematiksel modelleme
içeren) kontrol teorisi amaçlı kullanılabilir. İniş problemi kolay
değil; rüzgar, yerçekim etkileriyle boğuşurken en az yakıt harcayip ve
yumuşak şekilde iniş yapmak ciddi bir optimizasyon problemi.</p>
<p><img width="400" src="https://1.bp.blogspot.com/-OIxLXQe2s7U/XSwvOIA8XQI/AAAAAAAAB1M/WNK70QseuswPtK7E7Zn1ogVhzqSGrE44ACLcBGAs/s1600/rocket-0100.png"/></p>
<p>İkinci iniş simülasyonu birinciyi kıyasla daha çetrefil bir iniş
modelliyor, geçende deniz üstünde bir platforma iniş yapan SpaceX'in
Falcon 9 ilk aşama roketi modellenmiş. Ufak bir hedefe iniş yapıldığı
için iş çok daha zor, ayrıca bu simülatörde kontroller sürekli
(continuous) olabiliyor, aya iniş ayrıksal kontrolle işliyor.</p>
<p>Aya iniş için <code>gym==0.9.4</code> kurulur, altta rasgele hareketler yaptıran
bir kod (ayrıca simülasyondan resim alınıyor),</p>
<pre><code class="python">import gym, six, pyglet, pandas as pd, numpy as np
import matplotlib.pyplot as plt

env = gym.make('LunarLander-v2')

observation = env.reset() 

for i in range(100):
    action = env.action_space.sample() 
    env.render()
    observation, reward, done, info = env.step(action)

    buffer = pyglet.image.get_buffer_manager().get_color_buffer()            
    image_data = buffer.get_image_data()
    if i % 10 == 0:
        image_data.save(filename='frames/lunar-%04d.png' % i)

    print (observation)
    if done: break

env.close()
</code></pre>

<p>Falcon 9 için ana proje</p>
<p><a href="https://github.com/arex18/rocket-lander">https://github.com/arex18/rocket-lander</a></p>
<p>Ama tüm bu kodlara gerek yok, simülatör için iki dosya yeterli
(<code>rocketlander.py</code> ve <code>constants.py</code>), bu dosyaları biz aldık, ve
alttaki dizinde bulunabilir ,</p>
<p><a href="https://github.com/burakbayramli/kod/tree/master/sk/2019/07">https://github.com/burakbayramli/kod/tree/master/sk/2019/07</a></p>
<p>Kontrol için taslak bir kod (sabit kontrol veriliyor). Kodda mesela
rüzgar etkisi nasıl eklenir görüyoruz,
<code>env.apply_random_x_disturbance</code> ile. İniş yapılan platform sanal bir
dalga sebebiyle sola ya da sağa kayıyor olabilir, bunu
<code>env.move_barge_randomly</code> ile veriyoruz.</p>
<pre><code class="python">from rocketlander import RocketLander
from constants import LEFT_GROUND_CONTACT, RIGHT_GROUND_CONTACT
import numpy as np
import pyglet

if __name__ == &quot;__main__&quot;:
    settings = {'Side Engines': True,
                'Clouds': True,
                'Vectorized Nozzle': True,
                'Starting Y-Pos Constant': 1,
                'Initial Force': 'random'}  # (6000, -10000)}

    env = RocketLander(settings)
    s = env.reset()

    left_or_right_barge_movement = np.random.randint(0, 2)

    for i in range(30):

            a = [10.0, 1.0, 1.0]                        
            obs, r, done, info = env.step(a)
            env.render()
            buffer = pyglet.image.get_buffer_manager().get_color_buffer()            
            image_data = buffer.get_image_data()
            if i % 10 == 0:
                image_data.save(filename='frames/rocket-%04d.png' % i)
            env.draw_marker(env.landing_coordinates[0], env.landing_coordinates[1])
            env.refresh(render=False)

            if s[LEFT_GROUND_CONTACT] == 0 and s[RIGHT_GROUND_CONTACT] == 0:
                env.move_barge_randomly
                (0.05, left_or_right_barge_movement)

                env.apply_random_x_disturbance \
                (epsilon=0.005, \
                 left_or_right=left_or_right_barge_movement)
                env.apply_random_y_disturbance(epsilon=0.005)
            if done: break
</code></pre>

<p><code>step</code> çağrısından gelen <code>obs</code> içinde o adımda bilinen roket hakkında
ölçümler var. Konumda</p>
<pre><code>x_pos, y_pos, x_vel, y_vel, lateral_angle, angular_velocity
</code></pre>

<p><code>x_pos, y_pos</code> roketin yatay, dikey konumu. <code>x_vel,y_vel</code> yatay, dikey
hız. <code>lateral_angle</code> roketin eğimi, <code>angular_velocity</code> açısal hız,
yani bu açının ne hızda değiştiği.</p>
<p>Kontrol aksiyonları <code>Fe,Fs,Psi</code>, bunlardan <code>Fe</code> ana itiş roketi, dikey
yönde. <code>Fs</code> yandaki nitrojenle çalışan iticileri kontrol ediyor. <code>Psi</code>
ile roketin açısının değiştirmek mümkün.</p>
<p>Diğer değişkenlerden, <code>env.remaining_fuel</code> kalan yakıtı raporlar,
<code>env.initial_mass</code> başlangıçtaki (yakıt dahil) kütle,
<code>env.get_landing_coordinates()</code> platformun yerini. Raporlanabilen tüm
değişkenleri <code>dir(env)</code> ile görebiliriz.</p>