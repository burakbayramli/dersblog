<h1>Ders 15</h1>
<!DOCTYPE html>
<html>
  <head>
    <title>Ders 15
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
<script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
</script>
</head>

<p>Bu önemli bir ders, ana konumuz yansıtma / izdüşüm (projection). Mesela
$b$ vektörünü alıp $a$ üzerine olan "yansımasını" hesaplamak. Bu
yansımayı sanki $a$'ya dik bir şekilde bir lamba açtık ve oradan gelen
ışık sonucunda $b$'nin $a$ üzerine düşen "gölgesini" hesaplıyoruz gibi
düşünebiliriz. </p>
<p><img alt="" src="15_1.png" /></p>
<p>Yansıtmayı yapmak için $b$'nin $a$'ya en yakın olduğu noktayı bulmalıyım. </p>
<p><img alt="" src="15_2.png" /></p>
<p>Bu noktaya $p$ diyebilirim, $b,a$ arasındaki en kısa mesafeye de bir nevi
"hata (error)"  olarak bakabilirim, bu mesafeye $e$ harfini
vereceğim. Hata sözünü kullandık, çünkü, sanki $b$, $a$'dan "sapmış" ve
biz bu sapmanın ölçüsünü buluyoruz gibi bakılabilir bu probleme. </p>
<p>Peki niye $e = b-p$? Şu resme bakalım, </p>
<p><img alt="" src="15_3.png" /></p>
<p>Basit vektör aritmetiğinden biliyoruz ki, birbirine zincirleme duran
vektörlerde, zincirin başından sonuna direk gidilmek için zincirdeki tüm
vektörler birbiriyle toplanır. Üstteki resimde $b = p + e$. Ufak bir
cebirsel işlemle $e = b - p$ buluruz. </p>
<p>Peki $p$'yi nasıl bulacağız? Amacımız bu, yansımayı bulmak. Muhakkak
elimizde bir dik üçgen var, eğer trigonometri yapıyor olsaydık, $\cos,
\sin$, vs kullanıp birşeyler bulabilirdik. Lıneer Cebir'in metotları çok
daha temiz.</p>
<p>Bildiklerimiz neler? Biliyoruz ki $p$, $a$'nin bir katı, çünkü aynı çizgi
üzerindeler. </p>
<p>$$ p = xa $$</p>
<p>diyelim. O zaman bulmak istediğim bu $x$ sayısı. </p>
<p>Bildiğimiz bir diğer şey, $e$ ve $a$'nin birbirine dik olduğu. İki vektörün
dik olmasının tercümesi nedir? İki vektörün noktasal çarpımının sıfır
olması. O zaman</p>
<p>$$ a^T e = 0 $$</p>
<p>$$ a^T(b - p) = 0 $$</p>
<p>$$ a^T(b - xa) = 0 $$</p>
<p>Tekrar düzenlersem</p>
<p>$$ xa^Ta = a^Tb $$</p>
<p>Sol taraftaki $a^Ta$ bir tek sayı artık (çünkü bir noktasal çarpım), onu
alıp sağ tarafa bölüm olarak taşıyabilirim,</p>
<p>$$ x = \frac{ a^Tb}{a^Ta} $$</p>
<p>İşte ihtiyacımız olan katsayı bu. Bunun içinde cosine bir şekilde var
tabii, ama trigonometriye hiç girmemize gerek yok, pür vektörler ile bu işi
hallettik. Sonra bu $x$'i alıp $p = ax$ ile $p$'yi hesaplıyoruz. Hepsini
biraraya koyarsak, </p>
<p>$$ p = a\frac{ a^Tb}{a^Ta} $$</p>
<p>Biraz zihin egzersizi yapalım: eğer $b$'yi iki katına çıkarırsam, $p$ ne
olur? İki katına çıkar. Peki $a$'yi  iki katına çıkarırsam? Üstteki resmi
düşünürsek, hiç değişmemeli. Cebirsel olarak ta bunu görebiliriz, üstteki
ve alttaki $a$'lardaki artış birbirini iptal edecektir. </p>
<p>Şimdi, olaya matrissel olarak bakmak gerekirse, bir yansıtma matrisi $P$
olsun istiyorum, öyle ki </p>
<p>$$ p = P b $$</p>
<p>olsun, yani bu matris $b$'ye uygulanınca $p$'yi bulayım. O zaman iki üstteki $p$
formülü içinden $b$ haricindeki kısımları çekip çıkartmam lazım.</p>
<p>$$ P  = \frac{ aa^T}{a^Ta} $$</p>
<p>Bu bir matris. Bölünen bir matris, bölen bir skalar. Bazı örnekleri
hesaplayalım, ve grafikleyelim,</p>
<pre><code class="python">o = np.array([5,5,5])
b = np.array([[3.,3.,3.]]).T
a = np.array([[0,5.,5.]]).T
P = a.dot(a.T) / a.T.dot(a)
p = P.dot(b)
print P
print p
</code></pre>

<pre><code>[[ 0.   0.   0. ]
 [ 0.   0.5  0.5]
 [ 0.   0.5  0.5]]
[[ 0.]
 [ 3.]
 [ 3.]]
</code></pre>

<pre><code class="python">import sys; sys.path.append('../../vision/vision_02')
from mpl_toolkits.mplot3d import Axes3D

import plot3d
fig = plt.figure(); ax = Axes3D(fig)

plot3d.plot_vector(fig, o, b)
ax.hold(True)
plot3d.plot_vector(fig, o, a, 'cyan')
ax.hold(True)
plot3d.plot_vector(fig, o, p, 'yellow')
ax.hold(True)
plt.savefig('linear_15_01.png')
</code></pre>

<p><img alt="" src="linear_15_01.png" /></p>
<p>$P$ ilginç bir matristir. Özellikleri nedir?</p>
<p>Kolon uzayı neydi? Bir vektörü o matris ile çarptığımızda sonuç her zaman
matrisin kolon uzayındadır. $P$'nin kolon uzayı $a$'dan geçen çizgidir,
seviyesi (rank) 1'dir, simetriktir (bir vektörü devriği ile sağdan çarpınca
sonuç matrisi simetrik olur), yani $P^T = P$. </p>
<p>Eger yansıtma matrisini iki kere uygularsam ne olur? Ikinci yansıtmanin
hicbir etkisi olmamasi gerekir, yani $P = P^2$. </p>
<p>Eğer daha yüksek boyutlara geçersek? O zaman üstüne yansıtma yaptığımız bir
çizgi olmayacak, üç boyutta bir düzlem, daha yüksek boyutlarda N boyutlu
bir altuzay olacak.</p>
<p>Yansıtma neye yarar? Önemli faydalarından biri $Ax = b$ denklemini çözerken
ise yarar. Bazen bu denklemin çözümü yoktur. Belki bilinmeyenlerin sayısından
daha fazla denklem verilmiştir. O zaman tam denklemi çözmeye uğraşmak
yerine, çözülebilecek en yakın şeyi çözmeye uğraşmak gerekir, yani </p>
<p>$$ A\hat{x} = p $$</p>
<p>ki $p$, $b$'nin $A$'nin kolon uzayına yansıtılmış hali olacak. Bir
"çözüm" olmak kolon uzayının bir kombinasyonu olmak demek ise, bu kolon
uzayına yansıtılan $b$ üzerinden çözümü elde edebilmeyi umabiliriz. 3
boyutta</p>
<p><img alt="" src="15_4.png" /></p>
<p>Üzerine yansıtma yapılacak düzlem nedir? Düzlemi belirlemek için onu
tanımlayacak bir baz bulabilirim, iki vektör yani, mesela $a_1,a_2$
diyelim. </p>
<p><img alt="" src="15_5.png" /></p>
<p>Bu iki vektörün birbirine dik olması şart değil, bağımsız olması gerekli
ama. $a_1,a_2$'nin yarattığı düzlem $A$'nin kolon uzayı ile aynıdır, yani</p>
<p>$$ A = 
\left[\begin{array}{rr}
\uparrow &amp;  \uparrow \\
a_1 &amp;   a_2 \\
\downarrow &amp;  \downarrow 
\end{array}\right]
 $$</p>
<p>$e$ düzleme diktir. Peki $p$ nedir? $a$ vektörlerinin bir kombinasyonudur, yani</p>
<p>$$ p = \hat{x}_1a_1 + \hat{x}_2a_2 $$</p>
<p>ya da daha temiz olarak</p>
<p>$$ p = A\hat{x} $$</p>
<p>Aradığımız $\hat{x}$. Anahtar şurada, $e$ yani </p>
<p>$$  b - A\hat{x}$$</p>
<p>düzleme dik. Ve düzleme dik ise, düzlemdeki <em>her vektöre</em> dik. O zaman </p>
<p>$$ a_1^T( b - A\hat{x}) = 0$$</p>
<p>$$ a_2^T( b - A\hat{x}) = 0$$</p>
<p>Fakat üstteki gibi iki ayrı formül yazmak yerine, matris formu kullanamaz
mıyım? </p>
<p>$$ 
\left[\begin{array}{rrr}
 &amp; a_1^T &amp; \\
 &amp; a_2^T &amp; 
\end{array}\right]
(b - A\hat{x}) = 
\left[\begin{array}{rrr}
0 \\
0 
\end{array}\right]
 $$</p>
<p>Ya da</p>
<p>$$ A^T(b - A\hat{x})  = 0 $$</p>
<p>Bu problemin çizgizel versiyonunde $A$ yerine $a$ kullanmıştık, ve $a$ tek
bir vektördü. Zaten $A$ yerine $a$ kullanırsak, aynı formülü elde
ediyoruz. </p>
<p>Bir soru soralım şimdi: $e$, yani $b - A\hat{x}$ hangi uzayın içindedir?
Cevap, $A^T$'nin sıfır uzayındadır (nullspace), yani $N(A^T)$ içinde. Sıfır
uzayı hakkında neler biliyoruz? Sıfır uzayı ve kolon uzayları birbirine
dikgendir (orthogonal). O zaman $e$ $N(A^T)$ içinde ise, $e \perp C(A)$
demektir, yani $e$ de kolon uzayına dikgendir. Devam edelim, üstteki
formülü düzenlersek,</p>
<p>$$ A^TA\hat{x} = A^Tb $$</p>
<p>Dikkat edersek, önceki versiyonda $a^Ta$ bir tek sayıydı, böylece onu
bölen olarak sağa geçirmiştik. Şimdi ne yapacağız? </p>
<p>$$ \hat{x} = (A^TA)^{-1}A^Tb $$</p>
<p>Daha önce </p>
<p>$$ p = A\hat{x} $$</p>
<p>demiştik, o zaman </p>
<p>$$ p = A(A^TA)^{-1}A^Tb $$</p>
<p>Demek ki yansıtma matrisi eşitliğin sağında $b$ harici olan tüm semboller, </p>
<p>$$ P = A(A^TA)^{-1}A^T $$</p>
<p>Şimdi dikkat, bilerek bir hata yapacağım, üstteki formülün sağ tarafını
cebirsel olarak manipüle edeceğim</p>
<p>$$  AA^{-1}(A^T)^{-1}A^T = I$$</p>
<p>Bu yanlış duruyor, $P$ birim matris olamaz. Nerede hata yaptık?
Manipülasyon mekanik, teknik olarak doğru. Hata $A$'nin kare matrisi
olmamasında. O sebeple $A^TA$'yi üstte yaptığım gibi parçalayamam çünkü
bir matrisin tersini alabilmek için onun en azından kare olması gerekir (bu
yeterli şart değil tabii ki). </p>
<p>Yansıma matrislerinin simetrik olmasını bekliyordum, ve bakıyorum ki öyle. </p>
<p>$$ P^T = P $$</p>
<p>ve </p>
<p>$$ P^2 = P $$</p>
<p>Kontrol edelim</p>
<p>$$=  A(A^TA)^{-1}A^T \ A(A^TA)^{-1}A^T $$</p>
<p>$$=  A(A^TA)^{-1}\cancel{A^T \ A(A^TA)^{-1}}A^T $$</p>
<p>$$=  A(A^TA)^{-1}A^T $$</p>
<p>Üstteki son ifade $P$'ye eşit. </p>
<p>Uygulama: En Az Kareler (Least Squares)</p>
<p>Ne zaman formülden daha fazla veri vardır? Mesela veriye çizgi "uydurmak
(fitting)" istediğimde durum budur. Diyelim ki $t,D$ eksenleri üzerinde</p>
<p><img alt="" src="15_6.png" /></p>
<p>Veri şöyle olsun, $(1,1),(2,2),(3,2)$, üç tane nokta. Bu noktalara en yakın
şekilde geçecek çizgi kabaca şöyle olur [çizgi pek düz olmadı ama neyse].</p>
<p><img alt="" src="15_7.png" /></p>
<p>Bu problem ödevde $b = C+Dt$ olarak gösterildi. O zaman </p>
<p>$$ C + D = 1 $$</p>
<p>$$ C + 2D = 2 $$</p>
<p>$$ C + 3D = 2 $$</p>
<p>Bu tür problemleri çözerken anahtar yaklaşım bu, formülü yazalım, ve çözmek
istediğimiz (ama çözemediğimiz) denklemler serisini ortaya
çıkaralım. Matris olarak yazarsak, </p>
<p>$$ 
\underbrace{
\left[\begin{array}{rr}
1 &amp; 1 \\
1 &amp; 2 \\
1 &amp; 3 
\end{array}\right]
}_{A}
\underbrace{
\left[\begin{array}{r}
C  \\
D<br />
\end{array}\right]
}_{x}
=
\underbrace{
\left[\begin{array}{r}
1 \\
2 \\
2<br />
\end{array}\right]
}_{b}
 $$</p>
<p>Gördüğümüz gibi 3 tane denklem ve 2 tane bilinmeyen var. Yani verilen
(denklemler) bilinmeyenlerden daha fazla. Bu sebeple bazı denklemler (ya da
hiçbiri) doğal olarak tam olarak uymayacak. Amaç $Ax = b$'yi çözmek değil,
yansımayı çözmek. O zaman $A$'yi alttaki yerine koyunca, çözüm ortaya
çıkacaktır. </p>
<p>$$ \hat{x} = (A^TA)^{-1}A^Tb $$</p>
<p>Ekler</p>
<p>Matris tersi kullanmadan vektörün düzlem üzerine yansıtmasını daha direk
bir şekilde şöyle anlatabilirdik [1]: hatırlarsak, bir $u$ vektörünün diğer
bir $v$ vektörünün üzerine yansıtması (operasyonu $\mathrm{proj}$ ile belirtelim)</p>
<p>$$ \mathrm{proj}_v(u) = \frac{u \cdot v}{||v||^2} $$</p>
<p>idi. O zaman $u$'nun bir düzlem üzerine yansıtmasını $u$'nin içinde o
düzleme dik olan bileşenlerini çıkartarak bulabiliriz. Düzlemi yatay olarak
düşünürsek $u$ içinden düzleme dikey olan bileşenleri çıkartınca geriye
$u$'nun yatay bileşenleri kalır, bu da $u$'nun düzleme yansıtılmış hali
demektir. Peki düzleme dikey olan vektörü nasıl buluyoruz? Bu vektör zaten
biliniyor, bu vektör düzlemin normal vektöründen başka bir şey
değil. Normal vektor $n$ icin formul,</p>
<p>$$ \mathrm{proj}_{\textrm{düzlem}}(u) = u - \mathrm{proj}_{n}(u) = u - \frac{u \cdot n}{||n||^2} n $$</p>
<p>Bir örnek üzerinde görelim, </p>
<pre><code class="python">import sys; sys.path.append('../../vision/vision_02')
from mpl_toolkits.mplot3d import Axes3D
import plot3d
o = np.array([5,5,5])
u = np.array([3,3,3])
n = np.array([-1/3.,2/3.,2/3.])

fig = plt.figure()
ax = Axes3D(fig)
plot3d.plot_plane(ax, o, n, size=5)
plot3d.plot_vector(fig, o, u)
plot3d.plot_vector(fig, o, 3*np.array(n), 'red')
plt.savefig('15_8.png')
</code></pre>

<p><img alt="" src="15_8.png" /></p>
<p>Mavi vektörü düzleme yansıtmak istiyoruz. </p>
<pre><code class="python">p = u - (np.dot(u,n) / np.dot(n,n)) * n
print p
</code></pre>

<pre><code>[ 4.  1.  1.]
</code></pre>

<pre><code class="python">fig = plt.figure()
ax = Axes3D(fig)
plot3d.plot_plane(ax, o, n, size=5)
plot3d.plot_vector(fig, o, u)
plot3d.plot_vector(fig, o, p, 'cyan')
plot3d.plot_vector(fig, o, 3*np.array(n), 'red')
plt.savefig('15_9.png')
</code></pre>

<p><img alt="" src="15_9.png" /></p>
<p>Bir Düzlem Üzerindeki İki Vektör Arasındaki Açıyı Bulmak</p>
<p>Şu resme bakalım,</p>
<pre><code class="python">n = np.array([-1/3.,2/3.,2/3.])
o = np.array([5,5,5])
u1 = np.array([3,3,3])
u2 = np.array([-3,0,3])

fig = plt.figure()
ax = Axes3D(fig)
plot3d.plot_plane(ax, o, n, size=5)
p1 = u1 - (np.dot(u1,n) / np.dot(n,n)) * n
p2 = u2 - (np.dot(u2,n) / np.dot(n,n)) * n
plot3d.plot_vector(fig, o, 3*n,'red')
plot3d.plot_vector(fig, o, u1)
plot3d.plot_vector(fig, o, u2)
plot3d.plot_vector(fig, o, p1,'cyan')
plot3d.plot_vector(fig, o, p2,'skyblue')
plot3d.plot_vector(fig, o, 0.5*np.cross(p1,p2),'yellow')
ax.view_init(elev=30, azim=30)
plt.savefig('15_10.png')
</code></pre>

<p><img alt="" src="15_10.png" /></p>
<p>Koyu mavi iki vektörün düzlem üzerinde yansıtılmasını görüyoruz (açık ve
biraz daha açık mavi iki vektör). Bu vektörler arasındaki açı nedir? Tabii
açı derken <em>hangi yöne doğru açı</em> bulunmak isteniyor, bu soru da
önemli. Çoğu zaman bir referans vektörüne olan ikinci bir vektörün saat
yönü ya da onun tersi yöndeki açısını isteriz. Eger açıyı bilinen</p>
<p>$$ \theta = \arccos \frac{u \cdot v}{||u||||v|||}$$</p>
<p>ile hesaplarsak, bu hesap bize her zaman iki vektör arası en "yakın"
açıyı verir (yani 180'den daha az olan açıyı). Fakat biz mesela saat yönü
tersindeki açıyı istiyorsak, o zaman potansiyel olarak 180'den fazla açılar
da elde edebilmemiz gerekir.</p>
<p>Çözüm için çapraz çarpım kullanabiliriz, $n \cdot (u \times v)$ hesabına
bakarız, bu hesap artı ise üstteki $\theta$'yi olduğu gibi alırız, değil
ise $360-\theta$'yi kullanırız. Bunun sebebi $u \times v$ bize sağ el
kuralına göre, bkz [2], $u,v$ referanslı bir üçüncü vektör veriyor. Sağ el
kuralınında eğer $u$'dan başlayıp $v$'ye saat yönü tersine giderken 180
dereceden az bir gidiş yeterli ise, üçüncü vektör yukarı doğru işaret
ediyor, yoksa aşağı doğru. Mesela üstteki örnekte vektör düzlem normaline
ters, yani aşağı. Bu bize ilgilendiğimiz gidiş yönündeki açının 180'den
fazla olduğuna dair bir işaret, o zaman $360 - \theta$ kullanmamız
gerekir. Noktasal çarpım aynı yön / terslik hesabı için; üçüncü vektörün
düzlem normali ile noktasal çarpımı eğer aynı yönde ise artı, değil ise
eksi olacağı için 360'dan çıkartma irdelemesini bu şekilde yapabiliriz.</p>
<pre><code class="python">import numpy.linalg as lin
deg = np.rad2deg(np.arccos(np.dot(p1,p2) / (lin.norm(p1)*lin.norm(p2))))
s = np.dot(n, np.cross(p1,p2))
print 'deg', deg
if s &lt; 0: print '360 - deg =', 360-deg
else: print 'deg', deg
</code></pre>

<pre><code>deg 135.0
360 - deg = 225.0
</code></pre>

<p>Kaynaklar</p>
<p>[1] Maplesoft, <em>Projection of a Vector onto a Plane</em>, <a href="http://www.maplesoft.com/support/help/Maple/view.aspx?path=MathApps/ProjectionOfVectorOntoPlane">http://www.maplesoft.com/support/help/Maple/view.aspx?path=MathApps/ProjectionOfVectorOntoPlane</a></p>
<p>[2] Bayramli, Yapay Görüş ve Robotik, <em>Ders 2</em></p>