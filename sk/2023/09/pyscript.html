
<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
   <script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
   </script>
   <link rel="stylesheet" type="text/css" media="screen" href="https://burakbayramli.github.io/css/style.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1548953794786292"
          crossorigin="anonymous"></script>  
  </head>
    <body>
      <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">
            <a href="https://burakbayramli.github.io" style="text-decoration:none; color:inherit;">dersblog</a>
          </h1>
          <h2 id="project_tagline"></h2>          
        </header>
      </div>
      <div id="main_content_wrap" class="outer">        
        <section id="main_content" class="inner">
        <h1></h1>
<h1>Javascript Yerine Tarayıcıda Python, PyScript</h1>

<p>Tarayıcı tarafında kullanılan dil Javascript adlı bir dil, Java'nın
daha dinamik, güçlü tipleme gerektirmeyen bir hali denebilir. Bu dil
oldukca güçlüdür, müşteri tarafında gereken neredeyse her işlemi,
hesabı yapabilir. Önemli nokta, Javascript işlediğinde bu kodları
tarayıcı işletilir yani bağlanan kişinin CPU'şu bu kodları
işletmektedir, servis tarafı değil.</p>

<p>Peki tarayıcıda başka diller mümkün mü? Farklı dilleri WebAssembly
altyapısı üzerinen Javascript'e derlemek mümkün. Fakat PyScript [1]
yaklaşımı en temiz, basit, hızlı yöntem, sayfa içinde iki dosya dahil
ediliyor, ve bundan sonra tam tekmilli Python kodlarını sayfa içine
koymak mümkün oluyor.</p>

<h3>Başlangıç</h3>

<p>Basit bir kodu altta görüyoruz. Bu sayfada tek bir metin kutusu var,
bir de düğme. Kutuya girilen yazı OK tuşuna basınca aynı sayfa
üzerinde gösterilecek. Kodun gösterdiği kabiliyetler form öğeleri ile
iletişim kurabilme, ve sayfaya bilgi yazabilmek, bunun için DOM
objelerine erişmek, mesela <code>output</code> kimlikli <code>&lt;div&gt;</code> HTML objesi içine
çıktı veriliyor.</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://pyscript.net/latest/pyscript.css&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://pyscript.net/latest/pyscript.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;output&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">py-script</span><span class="p">&gt;</span>
      def write_to_page():
         inp = Element(&quot;search&quot;)
         Element(&quot;output&quot;).element.innerText = inp.element.value
    <span class="p">&lt;/</span><span class="nt">py-script</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;search&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;search&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">py-click</span><span class="o">=</span><span class="s">&quot;write_to_page()&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;btn1&quot;</span><span class="p">&gt;</span>OK<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Test etmek için üstteki kodları mesela bir <code>tst1.html</code> dosyasına yazarız,
ve o dizinde </p>

<pre><code>python -m http.server 8080 --bind 127.0.0.1
</code></pre>

<p>komutunu işletiriz, <code>http.server</code> Python içindeki hafif bir Web
servisidir, Flask yapabilirdik o da çok kolay ama üstteki yöntem daha
da basit. Şimdi,</p>

<pre><code>http://localhost:8080/tst1.html
</code></pre>

<p>adresini ziyaret ederiz, sayfa yüklenirken <code>pyscript.js</code> yüklenecek,
birkaç saniye alabilir, <a href="pyscript_01.jpg">şöyle</a> bir ekran gösterilir
o sırada, önemli değil, yükleme bitince OK düğmesine tıklanır ve sonuç
görülür.</p>

<p>Gerekli <code>.js</code>, <code>.css</code> dosyalarını pyscript.net yerine aynı dizinden
servis edebilirdik, bu durumda <code>pyscript.js</code> ve <code>pyscript.css</code>
indirilir, dizine koyulur sayfa kodunun <code>&lt;head&gt;</code> bölümu şöyle
değiştirilir,</p>

<div class="codehilite">
<pre><span></span><code>  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;pyscript.css&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;pyscript.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre>
</div>

<h3>HTML Üretmek</h3>

<p>Pyscript kodunda <code>element.innerText</code> çağrısı ile bir metni sayfaya yazabildik.
Eğer HTML gösterilsin istiyorsak, mesela bağlantılar, renkli yazılar, listeler
gibi daha çetrefilli çıktılar için <code>.innerHTML</code> kullanabiliriz.</p>

<p>Bir örnekte görelim, 0 ila 9 arasındaki sayıları gezip URL bağlantılarını
dinamik olarak değiştirip sayfaya o şekilde basacağız,</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  ...
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;output&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">py-script</span><span class="p">&gt;</span>
      def write_to_page():
         line = &quot;&quot;
         for i in range(10):
            s = &#39;<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://blah.blah%d.com&quot;</span><span class="p">&gt;</span>Link %d<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>&#39; % (i,i)
            line = line + s
         Element(&quot;output&quot;).element.innerHTML = line
    <span class="p">&lt;/</span><span class="nt">py-script</span><span class="p">&gt;</span>

     <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">py-click</span><span class="o">=</span><span class="s">&quot;write_to_page()&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;btn1&quot;</span><span class="p">&gt;</span>OK<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Düğmeye basınca bu kod 10 tane bağlantı üretmeli, Link 0, Link 1 gibi..</p>

<h3>Http ile Uzaktaki Dosyayı Okumak, İşlemek</h3>

<p>Aynen Javascript ile olduğu gibi PyScript bir dosya servisindeki
(fileserver) bir dosyayı URL ile okuyup işleyebilir. Alttaki örnek
için Flask lazım (basit web servisinde olmuyor), aynı dizinde bir
<code>test1.json</code> dosyası yarattık ve içinde <code>{"a": 1, "b": 2}</code> değerleri
var, dosyayı HTML sayfası ile berabe Flask <code>static</code> dizini içine
koyduk.</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;pyscript.css&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;pyscript.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
      <span class="p">&lt;</span><span class="nt">py-script</span><span class="p">&gt;</span>
          from pyodide.http import open_url
          url = &#39;http://localhost:5000/static/test1.json&#39;
          df = open_url(url)
          display(df.getvalue())
      <span class="p">&lt;/</span><span class="nt">py-script</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Sayfayı yükleyince bu değerlerin ekrana basıldığını göreceğiz.</p>

<p>Eğer ham JSON dosyasını indirebiliyorsak bu dosya içeriğini JSON
paketi ile işlemek te mümkün olacak muhakkak? Böylece içeriğe
bildiğimiz sözlük, liste kavramları ile erisebiliriz, üstteki kodu
şöyle değiştirelim,</p>

<pre><code>from pyodide.http import open_url
import json
...
df = open_url(url)
d = json.loads(df.getvalue())
display(d['a'])
</code></pre>

<p>Bu kod ekrana sadece <code>1</code> değeri basacak.</p>

<p>Web üzerinden dosya erişimi pek çok fayda sağlar, mesela 5-10 MB veri
dosyalarını gerektiği yerde indirip içeriklerini ek işlemlere tabi
tutmak mümkün.</p>

<p>Karşılaştırma amacıyla aynı işlemi (JSON işleme kısmı yok) Javascript ile
yapalım,</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">doit</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">xmlHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
      <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.43.49:5000/static/test1.json&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span> 
      <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="kc">null</span> <span class="p">);</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;doit()&quot;</span><span class="p">&gt;</span>OK<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<h3>Diger Paketler</h3>

<p>Fakat kabiliyetler bunlarla sınırlı değil. PyScript taklit bir Python
ortamı değil, tam tekmilli bir Python ortamı. Amacı bildik Python
yorumlayıcısını tamamen Javascript bazlı işletmek. Bu sebeple mesela
dış paket yüklemesi de pek çok paket için işliyor. Mesela altta
<code>pandaş</code> paketinin kurulduğu ve bir CSV verisini işlediği örneği
görüyoruz. Daha fazla örnekler [1]'de bulunabilir.</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;pyscript.css&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;pyscript.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>    
    <span class="p">&lt;</span><span class="nt">py-config</span><span class="p">&gt;</span>
      packages = [&quot;pandas&quot;]
    <span class="p">&lt;/</span><span class="nt">py-config</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">py-script</span><span class="p">&gt;</span>
      import pandas as pd

      from pyodide.http import open_url

      url = (&quot;https://raw.githubusercontent.com/Cheukting/pyscript-ice-cream/main/bj-products.csv&quot;)
      ice_data = pd.read_csv(open_url(url))
      display(ice_data)
    <span class="p">&lt;/</span><span class="nt">py-script</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<p><img src="pyscript_02.jpg" alt="" /></p>

<p>Kaynaklar</p>

<p>[1] PyScript, https://docs.pyscript.net/latest/tutorials/getting-started.html</p>

          <br/><a href="../index.html">Yukarı</a>
        </section>          
      </div>
    </body>
</html>
