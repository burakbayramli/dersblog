<h1>Gson, Java Objelerini JSON Olarak Yazmak, Okumak</h1>
<p>Gson, Java Objelerini JSON Olarak Yazmak, Okumak</p>
<p>Java nesnelerini diske nasıl yazıp okuruz, eski ismiyle (!) serileştiririz (serialization) konusuna bakarken şu kodu gördük,</p>
<p>https://github.com/google/gson</p>
<p>Gson projesi Google tarafından geliştirilmiş, pek çok kişinin alışık olduğu JSON formatına objelerin yazılıp okunmasını sağlıyor.</p>
<p>Bizim için en çok gereken "objeler arası göstergeç takibi olup olmadığı", yani A nesnesi B nesnesine referans ediyor, acaba A'yı diske yaz dediğimizde B referansı takip edilip o da A ile beraber yazılacak mı? Ufak bir test bunun olduğunu gösteriyor.</p>
<p>Kurmak için derlemeye gerek yok, Maven tüm dünyayı indirebilir, tek bir jar yeterli,</p>
<p>http://repo1.maven.org/maven2/com/google/code/gson/gson/2.8.0/gson-2.8.0.jar</p>
<p>Simdi</p>
<p>public class Exam {
    public String SUBJECT;
    public double GRADE;
    @Override
    public String toString() {
        return SUBJECT + " - " + GRADE;
    }    
}</p>
<p>public class Person {
    public String NAME;
    public String LOCATION;
    public Exam EXAM;
    @Override
    public String toString() {
        return NAME + " - " + LOCATION;
    }    
}</p>
<p>import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.Writer;</p>
<p>public class Test {
    
    public static void main(String[] args) {
        Gson gson = new GsonBuilder().create();
        Exam ee = new Exam();
        ee.SUBJECT = "adsasf";
        Person pp = new Person();
        pp.NAME = "Husnu";
        pp.EXAM = ee;   
        try {
            Writer writer = new OutputStreamWriter(new FileOutputStream("Output.json") , "UTF-8");
            gson.toJson(pp, writer);
            writer.close();
        } catch (Exception e) {System.err.println("yazim hatasi"); } 
    }
}</p>
<p>Bu kodlar kendi java dosyalarinda olacak tabii ki.. Derleyelim,</p>
<p>javac -classpath gson-2.8.0.jar:. Test.java</p>
<p>java  -classpath gson-2.8.0.jar:. Test</p>
<p>Kod isledi, sonuc olarak Output.json yazildi, icinde </p>
<p>{"NAME":"Husnu","EXAM":{"SUBJECT":"adsasf","GRADE":0.0}}</p>
<p>goruluyor.</p>
<p>Okumak icin iki turlu yol gosterelim, ilki direk diskten okumak, ikincisi bir String icindeki objeyi okumak.</p>
<p>import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import java.io.*;</p>
<p>public class Test2 {
    
    public static void main(String[] args) {
        Gson gson = new GsonBuilder().create();
        try {
            // disk
            InputStream in = Person.class.getResourceAsStream("Output.json");       
            Reader reader = new InputStreamReader(in, "UTF-8");
            Person p1 = gson.fromJson(reader, Person.class);
            System.out.println(p1);</p>
<p>// string
            String s = "{'NAME':'Husnu','EXAM':{'SUBJECT':'adsasf','GRADE':0.0}}";
            Person p2 = gson.fromJson(s, Person.class);
            System.out.println(p2);
            
        } catch (Exception e) { System.err.println("okuma hatasi"); }
        
    }
}</p>
<p>Şimdi ilginç bir kullanım görelim. Acaba Java bağlamında sözlük içinde sözlük içeren bir veri yapısını nasıl okurum / yazarım, daha doğrusu Java objesi olarak yazılıp / okunan şey neye benzer? Belki bu tür veriyi Python'dan üretiyorum, ve onu olduğu gibi Java'da okuyabilmek istiyorum. Bir deneme yaptık, tahmin olarak herhalde (GeoMap.java icinde)</p>
<p>import java.util.*;
public class GeoMap extends HashMap&gt; { }</p>
<p>gibi bir kod olacakti. Yazmak icin </p>
<p>import com.google.gson.Gson;</p>
<p>import com.google.gson.GsonBuilder;</p>
<p>import java.io.FileOutputStream;</p>
<p>import java.io.IOException;</p>
<p>import java.io.OutputStreamWriter;</p>
<p>import java.io.Writer;</p>
<p>import java.util.*;</p>
<p>public class Test3 {</p>
<p>public static void main(String[] args) {</p>
<p>Gson gson = new GsonBuilder().create();</p>
<p>GeoMap m = new GeoMap();</p>
<p>m.put("11.111 22.2222", new HashMap());</p>
<p>m.put("22.111 22.2222", new HashMap());</p>
<p>m.get("11.111 22.2222").put("11.111 22.4444", "10.0");</p>
<p>m.get("22.111 22.2222").put("33.111 22.2222", "11.0");</p>
<p>try {</p>
<p>Writer writer = new OutputStreamWriter(new FileOutputStream("Output.json") , "UTF-8");</p>
<p>gson.toJson(m, writer);</p>
<p>writer.close();</p>
<p>} catch (Exception e) {System.err.println("yazim hatasi"); }    </p>
<p>}</p>
<p>}</p>
<p>Bu kod hakikaten bekleneni yapti, veri suna benzedi, </p>
<p>{"22.111 22.2222":{"33.111 22.2222":"11.0"},"11.111 22.2222":{"11.111 22.4444":"10.0"}}</p>
<p>Okumak icin alttaki kod; isi biraz ilginclestirelim dedik, bir zip dosyasi icinden json okuyoruz (test icin ustteki dosya elle ziplenebilir)</p>
<p>import com.google.gson.Gson;</p>
<p>import com.google.gson.GsonBuilder;</p>
<p>import java.util.zip.*;</p>
<p>import java.io.*;</p>
<p>public class Test4 {</p>
<p>public static void main(String[] args) {</p>
<p>Gson gson = new GsonBuilder().create();</p>
<p>try {</p>
<p>ZipFile  zipFile =  new  ZipFile ("Output.json.zip");</p>
<p>ZipEntry e = zipFile.getEntry("Output.json");</p>
<p>InputStream in = zipFile.getInputStream(e);     </p>
<p>Reader reader = new InputStreamReader(in, "UTF-8");</p>
<p>GeoMap p = gson.fromJson(reader, GeoMap.class);</p>
<p>System.out.println(p.size());</p>
<p>System.out.println(p.get("22.111 22.2222"));</p>
<p>} catch (Exception e) {</p>
<p>e.printStackTrace();</p>
<p>System.err.println("okuma hatasi");</p>
<p>}</p>
<p>}</p>
<p>}</p>