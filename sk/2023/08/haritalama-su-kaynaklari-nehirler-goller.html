
<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
   <script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
   </script>
   <link rel="stylesheet" type="text/css" media="screen" href="https://burakbayramli.github.io/css/style.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1548953794786292"
          crossorigin="anonymous"></script>  
  </head>
    <body>
      <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">
            <a href="https://burakbayramli.github.io" style="text-decoration:none; color:inherit;">dersblog</a>
          </h1>
          <h2 id="project_tagline"></h2>          
        </header>
      </div>
      <div id="main_content_wrap" class="outer">        
        <section id="main_content" class="inner">
        <h1></h1>
<h1>Haritalama, Nehirler, Göller</h1>

<p>SHP dosyasi olarak farkli detaylarda nehirlerin, gollerin yerlerini
gosteren veri dosyalar GSHHG verisinde bulunabilir. SHP dosyalarinin
nasil islenecegini [2] yazisinda gormustuk. Su alanlari verisi tek bir
zip [1] olarak indirilebilir, acilinca</p>

<p>GSHHS_shp</p>

<p>WDBII_shp</p>

<p>dizinleri görülür. </p>

<p>Nehirler <code>WDBII_shp</code> altında ve alt dizinler olarak c,i,f,h,l
mevcut. Bu alt dizinlerin kodlaması şöyle,</p>

<p><code>f</code>: Tam çözünürlük. Verinin en ham, en detaylı hali bu dizin altında.</p>

<p><code>h</code>: Yüksek çözünürlük.  Douglas-Peucker çizgi indirgemesi
    kullanılmştir, ve veri büyüklüğü ~80% oranında azaltılmıştır (bazı
    detaylar kaybolmuştur doğal olarak).</p>

<p><code>i</code>: Orta seviye çözünürlük.  Bir önceki 'h' seviyesine göre yine ~80%
    azaltma var.</p>

<p><code>l</code>: Düşük çözünürlük: Önceki 'i' ye göre ~80% indirim</p>

<p><code>c</code>: Kaba çözünürlük. Bir indirim daha, bu en düşük çözünürlük, en
     küçük veri büyüklüğü burada.</p>

<p>Her dosya ismi `WDBII<em>river</em>&lt;çözünürlük>_L<seviye>.* olarak
kodlanmıştır, seviye (level) hangi 'tip' su öbeğinin veriye dahil
edildiğini kontrol eder.</p>

<p>Seviye  1: Nehir-goller
Seviye  2: Kalici, buyuk nehirler
Seviye  3: Ek ana nehirler
Seviye  4: Yine ekler
Seviye  5: Kucuk boyuttaki nehirler
Seviye  6: Ana ve gecici nehirler
Seviye  7: Ana ve gecici nehirler - ekler
Seviye  8: Ufak boyuttaki gecici nehirler
Seviye  9: Buyuk kanallar
Seviye 10: Ufak kanallar
Seviye 11: Sulama kanallari</p>

<p>GSHHS<em><resolution></em>L<level>.*</p>

<p>Seviye 1: Continental land masses and ocean islands, except Antarctica.
Seviye 2: Lakes
Seviye 3: Islands in lakes
Seviye 4: Ponds in islands within lakes
Seviye 5: Antarctica based on ice front boundary.
Seviye 6: Antarctica based on grounding line boundary.</p>

<p>Gerekli detaylılık, bilgi tipine göre üstteki seçeneklerden herhangi biri
devreye sokulabilir.</p>

<p>Bazı önemli notlar; bazen yaygın olarak 'nehir' olarak tanımlanan
alanlar GSHHG için bu şekilde tanımlanmamış olabilir. Dışarıdan
gözlenenler için birbiri ile bağlantılı çok geniş olmayan ve akıntısı
olan şu öbekleri bağlantılı bir nehirdir, fakat bu şekilde grafikleme
yaptığımızda, örnek olarak Ukrayna'daki Dniper nehrini alalım,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">pygeodesy.sphericalNvector</span> <span class="kn">import</span> <span class="n">LatLon</span><span class="p">,</span> <span class="n">perimeterOf</span><span class="p">,</span> <span class="n">meanOf</span>
<span class="kn">import</span> <span class="nn">shapefile</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;/tmp&quot;</span>
<span class="n">lim</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span> <span class="nf">plot_rivers</span><span class="p">():</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;/WDBII_river_c_L02.shp&quot;</span>
    <span class="n">rivers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">records</span><span class="p">()</span>
    <span class="n">waters</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">shapes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waters</span><span class="p">)):</span>
        <span class="n">water</span> <span class="o">=</span> <span class="n">waters</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">water</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">water</span><span class="o">.</span><span class="n">points</span><span class="p">)]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">water</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">previous</span><span class="p">:</span><span class="n">current</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lim</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">latlons</span> <span class="o">=</span> <span class="p">[</span><span class="n">LatLon</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">geo</span><span class="p">]</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">perimeterOf</span><span class="p">(</span><span class="n">latlons</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">6371</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">meanOf</span><span class="p">(</span><span class="n">latlons</span><span class="p">)</span>
        <span class="n">latlons</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">lon</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">latlons</span><span class="p">]</span>
        <span class="n">regarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">latlons</span><span class="p">)</span>    
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">regarr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">regarr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code><span class="n">plot_rivers</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">35.1461994056707</span><span class="p">,</span><span class="mf">47.82578151155012</span><span class="p">,</span><span class="s2">&quot;Zaporizhza&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">34.58240228690867</span><span class="p">,</span><span class="mf">48.542927718410105</span><span class="p">,</span><span class="s2">&quot;Kamianske&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span><span class="mi">55</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;su1.jpg&#39;</span><span class="p">,</span><span class="n">quality</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre>
</div>

<p>şuradaki gibi bir görüntü ortaya çıkacaktır. Ana nehirleri seçtik,
detay <code>c</code> seviyesi, kabaca olsa bile bir nehir görüntüsünün ortaya
çıkmasını bekledik, fakat olmadı. Burada eksik olan GSHHG verisinin
Dnieper'in bazı bölümlerini göl olarak kaydetmiş olmasıdır.  O zaman
hem nehir hem göl grafiklemesi gerekir,</p>

<div class="codehilite">
<pre><span></span><code><span class="k">def</span> <span class="nf">plot_lakes</span><span class="p">():</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;/GSHHS_l_L2.shp&quot;</span>
    <span class="n">rivers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">records</span><span class="p">()</span>
    <span class="n">waters</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">shapes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waters</span><span class="p">)):</span>
        <span class="n">water</span> <span class="o">=</span> <span class="n">waters</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">water</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">water</span><span class="o">.</span><span class="n">points</span><span class="p">)]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">water</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">previous</span><span class="p">:</span><span class="n">current</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lim</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">latlons</span> <span class="o">=</span> <span class="p">[</span><span class="n">LatLon</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">geo</span><span class="p">]</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">perimeterOf</span><span class="p">(</span><span class="n">latlons</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">6371</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">meanOf</span><span class="p">(</span><span class="n">latlons</span><span class="p">)</span>
        <span class="n">latlons</span> <span class="o">=</span> <span class="p">[[</span><span class="n">a</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">lon</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">latlons</span><span class="p">]</span>
        <span class="n">regarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">latlons</span><span class="p">)</span>    
        <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">regarr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">regarr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">)</span>

<span class="n">plot_rivers</span><span class="p">()</span>
<span class="n">plot_lakes</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">35.1461994056707</span><span class="p">,</span><span class="mf">47.82578151155012</span><span class="p">,</span><span class="s2">&quot;Zaporizhza&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">34.58240228690867</span><span class="p">,</span><span class="mf">48.542927718410105</span><span class="p">,</span><span class="s2">&quot;Kamianske&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span><span class="mi">55</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/tmp/out2.jpg&#39;</span><span class="p">,</span><span class="n">quality</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="su2.jpg" alt="" /></p>

<p>Bu daha net bir nehir görüntüsü ortaya çıkardı. </p>

<p>Kaynaklar</p>

<p>[1] https://www.ngdc.noaa.gov/mgg/shorelines/data/gshhg/latest/</p>

<p>[2] ../../2020/02/haritalamak.html</p>

          <br/><a href="../index.html">Yukarı</a>
        </section>          
      </div>
    </body>
</html>
