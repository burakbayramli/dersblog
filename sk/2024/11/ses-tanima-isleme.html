
<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
   <script type="text/javascript"
       src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
   </script>
   <script async="async" data-cfasync="false" src="//pl22489825.profitablegatecpm.com/d84f574876e65b2d8f0c7bae784c22b3/invoke.js"></script>

   <link rel="stylesheet" type="text/css" media="screen" href="https://burakbayramli.github.io/css/style.css">
  </head>
    <body>
      <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">
            <a href="https://burakbayramli.github.io" style="text-decoration:none; color:inherit;">dersblog</a>
          </h1>
          <h2 id="project_tagline"></h2>          
        </header>
      </div>
      <div id="main_content_wrap" class="outer">        
        <section id="main_content" class="inner">
        <h1></h1>
<h1>Ses Tanıma, İşleme</h1>

<p>Veri Okuma, Yazma</p>

<p>Okuma işlemi <code>scipy.io.wavfile</code> ile yapılabilir, tek boyutlu bir vektör
elde edilecektir. Bir örnek görelim,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">scipy.io.wavfile</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/ow.wav&#39;</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/ao.wav&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ses_01.jpg&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="ses_01.jpg" alt="" /></p>

<p>Ses verisi sonuçta bir zaman serisidir. Şekil olarak iki temel sesin
(fonem) birbirinden farkı görülebiliyor.</p>

<p>Bu ses dosyalarını komut satırında çalmak için <code>aplay</code> ya da <code>ffmpeg</code>
kullanılabilir.</p>

<p>Eğer elde tek boyutlu bir ses verisi varsa diske yazmak için
<code>scipy.io.wavfile.write</code>,</p>

<div class="codehilite">
<pre><span></span><code><span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span> 
<span class="n">wav1tmp</span> <span class="o">=</span> <span class="n">wav1</span> <span class="o">+</span> <span class="mi">1000</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/tmp/out1.wav&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wav1tmp</span><span class="p">))</span>
</code></pre>
</div>

<p>İlginç bir durum ses dosyasını yukarı kaydırdık fakat ses çalınınca
hala aynı ses duyuluyor.</p>

<p>Fakat tüm ses verisini 100 ile bölersem, bu ``ses kısması'' demek, ses
azalır.</p>

<p>Ses Oluşturma</p>

<p>Kendimiz sinüs bazlı sesler yaratabilirdik,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">scipy.io.wavfile</span>

<span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span> 
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>    <span class="c1"># seconds</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">fs</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">440</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/tmp/out2.wav&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/tmp/out2.wav&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav3</span><span class="p">[:</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ses_02.jpg&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="ses_02.jpg" alt="" /></p>

<div class="codehilite">
<pre><span></span><code><span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span> 
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>  
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">fs</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">440</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">fs</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">220</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">x2</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/tmp/out2.wav&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav4</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/tmp/out2.wav&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav4</span><span class="p">[:</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ses_03.jpg&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="ses_03.jpg" alt="" /></p>

<p>Altta bir polis sireni örneği,</p>

<div class="codehilite">
<pre><span></span><code><span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="mi">1500</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="mi">100</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
</code></pre>
</div>

<p>Beyaz Gürültü</p>

<pre><code>fs = 16000 
y = np.random.randn(fs*10).astype(np.float32)
scipy.io.wavfile.write('/tmp/out4.wav', fs, y)
</code></pre>

<p>Ya da</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">length_in_seconds</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">amplitude</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">truncnorm</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">amplitude</span><span class="p">))</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">length_in_seconds</span><span class="p">)</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/tmp/noise.wav&#39;</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">noise</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">))</span>
</code></pre>
</div>

<p>Ses Verisini Karşılaştırmak</p>

<p>Ses verisi bir tür zaman serisi olduğuna göre bu zaman serisini bildik
araçlarla karşılaştıramaz mıyız? Mesela basit korelasyon, ya da basit
Öklitsel uzaklık ölçütleri ile bir mesafe irdelemesi kullansak olmaz
mi acaba?</p>

<p>Eğer amaç ses tanıma ise, basit karşılaştırma yöntemleri problem
çıkartabilir. Standart karşılaştırma metotları aynı boyutlarda ve
zaman dilimleri birbirine uyan veriyi bekler. Fakat gürültü konusunu
bir kenara bıraksak, boyutsal, genlik (amplitude) uyuşmazlık
problemleri olabilir. Yani aynı ses bazen daha yüksek genli, bazen faz
olarak sağa, sola kaymış olabilir, ya da ses verisi daha çok zamana
yayılmış olabilir. Bu tür veri durumlarında, özellikle ses
karşılaştırmasında Dinamik Zaman Eğriltmesi (Dynamic Time Warping
-DTW-) metotu var.</p>

<p>Dinamik Zaman Eğriltmesi</p>

<p><img src="ses_05.jpg" alt="" /></p>

<p>DTW ile iki zaman serisi arasında bir eşleme aranır, öyle ki optimal
eşleme üzerinden iki zaman serisi arasındaki toplam mesafe en minimal
olsun. Eğriltme metaforu niye kullanılmış resme bakınca anlıyoruz, bir
serideki her zaman dilimi birebir diğer serideki aynı zaman noktasına
eşlenmiyor, serilerin arasında kayma, büyüme, küçülme olabileceği
beklentisi ile eşleme farklı şekillerde olabiliyor, eşlemede "eğrilme"
görülebiliyor. Hatta bazen aynı zaman noktası diğer serideki birkaç
farklı noktaya bile eşlenebiliyor!</p>

<p>Bahsedilen eşlemenin bulunması bir arama gerektirir, pek çok seçenek
arasından arama yapılmalıdır, ve bu arama, $M$ ve $N$ büyüklüğündeki
iki zaman serisi için başlangıç DTW algoritmasında $O(M N)$
karmaşıklığına [1] sebep olur. Bu arama çok daha fazla yavaşlığa
sahip olabilirdi, fakat dinamik programlama ile bu süre biraz daha
kısaltılabiliyor. Detaylar için [1,4,5].</p>

<p>Standart DTW algoritması <code>simpledtw.py</code> içinde bulunabilir. Kullanım örneği,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">simpledtw</span>

<span class="n">series_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.13</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">series_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.42</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">series_3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">matches</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">mapping_1</span><span class="p">,</span> <span class="n">mapping_2</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">simpledtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_2</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">cost</span><span class="p">)</span>
<span class="n">matches</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">mapping_1</span><span class="p">,</span> <span class="n">mapping_2</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">simpledtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_3</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code>0.5499999999999998
18.94
</code></pre>
</div>

<p>Ses verileri için aynı işlemi uygulayabiliriz,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">scipy.io.wavfile</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/b.wav&#39;</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/d.wav&#39;</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/ay.wav&#39;</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code><span class="n">matches</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">mapping_1</span><span class="p">,</span> <span class="n">mapping_2</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">simpledtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav2</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">cost</span><span class="p">)</span>
<span class="n">matches</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">mapping_1</span><span class="p">,</span> <span class="n">mapping_2</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">simpledtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav3</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">cost</span><span class="p">)</span>
</code></pre>
</div>

<pre><code>856568.0
3479812.0
</code></pre>

<p>Üstteki işlemin biraz yavaş işlediği farkedilebilir, bunun sebebi
karmaşıklığın $O(MN)$ ya da aşağı yukarı benzer uzunluktaki seriler
için $O(M^2)$ olması. Karesel karmaşıklık hep kaçınmaya uğraştığımız
bir durum, mümkün olduğu kadar $O(M)$'e yakın olmak isteriz.</p>

<p>Hızlandırma amaçlı bir algoritma FastDTW [2,3] yaklaşımı, $O(M)$
karmaşıklığına sahiptir. Kodlaması <code>fastdtw.py</code> içinde. Aynı veriler
üzerinde kullanalım,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">euclidean</span>
<span class="kn">import</span> <span class="nn">fastdtw</span>

<span class="n">distance</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fastdtw</span><span class="o">.</span><span class="n">fastdtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav2</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">euclidean</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="n">distance</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fastdtw</span><span class="o">.</span><span class="n">fastdtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav3</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">euclidean</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">distance</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code>865169.0
3619304.0
</code></pre>
</div>

<p>Bu çağrının çok daha hızlı işlediğini göreceğiz.</p>

<p>Ses komut örnekleri üzerinde aynı programı işletelim (diğer komut ses
dosyaları [7] zip dosyasında var). Bu komutlardan ilk ikisi farklı
konuşmacıların söylediği "bed" kelimesi, üçüncüsü "down" kelimesi.
Acaba birinci ses komut dosyası 2'inci ve 3'üncü arasından hangi ses
zaman serisine daha yakın çıkacak?</p>

<div class="codehilite">
<pre><span></span><code><span class="n">tmp</span><span class="p">,</span> <span class="n">wav1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;vcommand/fb24c826_nohash_0.wav&#39;</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;vcommand/fb7c9b3b_nohash_2.wav&#39;</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav3</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;vcommand/fda46b78_nohash_1.wav&#39;</span><span class="p">)</span>

<span class="n">distance</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fastdtw</span><span class="o">.</span><span class="n">fastdtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav2</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">euclidean</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="n">distance</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fastdtw</span><span class="o">.</span><span class="n">fastdtw</span><span class="p">(</span><span class="n">wav1</span><span class="p">,</span> <span class="n">wav3</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">euclidean</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">distance</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code>10319233.0
19032652.0
</code></pre>
</div>

<p>İkinciye daha yakın çıktı, bu iyi bir sonuç.</p>

<p>Javascript</p>

<p>JS dilinde DTW için [8] kodu faydalı olabilir, indirip üst dizin
seviyesinde</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">var</span> <span class="nx">dtw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./src/dynamic-time-warping.js&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ser1</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">9</span><span class="p">,</span> <span class="mf">93</span><span class="p">,</span> <span class="mf">15</span><span class="p">,</span> <span class="mf">19</span><span class="p">,</span> <span class="mf">24</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">ser2</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">31</span><span class="p">,</span> <span class="mf">97</span><span class="p">,</span> <span class="mf">81</span><span class="p">,</span> <span class="mf">82</span><span class="p">,</span> <span class="mf">39</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">distFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span> <span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">dtw</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dtw</span><span class="p">.</span><span class="nx">DynamicTimeWarping</span><span class="p">(</span><span class="nx">ser1</span><span class="p">,</span> <span class="nx">ser2</span><span class="p">,</span> <span class="nx">distFunc</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dist</span> <span class="o">=</span> <span class="nx">dtw</span><span class="p">.</span><span class="nx">getDistance</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dist</span><span class="p">);</span>
</code></pre>
</div>

<p>şeklinde yazdığımız test başarılı sonuç verdi. </p>

<p>Fourier Analizi ile Sesi Sinüs Eğrilerine Ayırmak</p>

<div class="codehilite">
<pre><span></span><code><span class="n">tmp</span><span class="p">,</span> <span class="n">wav1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;phonemes/ow.wav&#39;</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wav1</span><span class="p">))</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
<span class="n">max_freqs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
     <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
     <span class="n">freq</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
     <span class="k">del</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
     <span class="n">freq_in_hertz</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">freq</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
     <span class="n">max_freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_in_hertz</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">max_freqs</span><span class="p">)</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code>[444.2545920546775, 451.0892780862879, 539.9401964972235, 526.2708244340025, 519.4361384023921, 553.6095685604442, 396.41178983340455, 355.40367364374197, 177.70183682187098, 239.2140111063648, 505.7667663391713, 580.948312686886, 423.7505339598462, 512.6014523707817, 423.7505339598462, 526.2708244340025, 676.6339171294319, 567.2789406236651, 820.1623237932507, 950.0213583938488]
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code><span class="n">T</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">fs</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">max_freqs</span><span class="p">:</span> 
     <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">fs</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
     <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
     <span class="n">tmp</span> <span class="o">+=</span> <span class="n">x</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">*</span> <span class="mf">500.</span>
<span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/tmp/out3.wav&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="kn">import</span> <span class="nn">scipy.io.wavfile</span>
<span class="n">tmp</span><span class="p">,</span> <span class="n">wav11</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/tmp/out3.wav&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ses_04.jpg&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="ses_04.jpg" alt="" /></p>

<p>Sinüssel Regresyon ile Ayırmak</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">wav1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;wav&#39;</span><span class="p">]</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">500</span><span class="p">):</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sin</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cos</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;wav&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;R^2&#39;</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">pvalues</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]))</span>
<span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</code></pre>
</div>

<div class="codehilite">
<pre><span></span><code>const   -1.746267e+00
x1      -3.873460e+13
x2       4.141772e+10
x3       8.071563e+13
x4      -9.792258e+12
dtype: float64
const    0.972714
x1       0.893328
x2       0.902068
x3       0.343704
x4       0.903365
dtype: float64
R^2 0.5121417785266622
48
2341
</code></pre>
</div>

<p>Kaynaklar</p>

<p>[1] <a href="https://github.com/talcs/simpledtw">SimpleDTW</a></p>

<p>[2] <a href="https://github.com/slaypni/fastdtw">FastDTW Kod</a></p>

<p>[3] <a href="https://cs.fit.edu/~pkc/papers/tdm04.pdf">FastDTW Makale</a></p>

<p>[4] Tavenard, <a href="https://rtavenar.github.io/blog/dtw.html">An introduction to Dynamic Time Warping</a></p>

<p>[5] Mishra, <a href="https://medium.com/walmartglobaltech/time-series-similarity-using-dynamic-time-warping-explained-9d09119e48ec">Time Series Similarity Using Dynamic Time Warping -Explained</a></p>

<p>[6] Bayramlı, Finans ve Zaman Serileri - Sezonsallık, Periyotlar</p>

<p>[7] <a href="https://www.dropbox.com/scl/fi/7bjyicydyyurizi314qp8/google_voice_small.zip?rlkey=l5ibbx480jld79exvkwih3szr&amp;st=ni9ibhbs&amp;dl=1">Ufak Ses Komut Verisi</a></p>

<p>[8] Lesti, <a href="https://github.com/GordonLesti/dynamic-time-warping">dynamic-time-warping</a></p>

          <div id="container-d84f574876e65b2d8f0c7bae784c22b3"></div>

          <br/><a href="../index.html">Yukarı</a>
        </section>          
      </div>
    </body>
</html>
