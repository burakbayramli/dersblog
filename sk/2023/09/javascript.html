
<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
   <script type="text/javascript"
       src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
   </script>
   <script async="async" data-cfasync="false" src="//pl22489825.profitablegatecpm.com/d84f574876e65b2d8f0c7bae784c22b3/invoke.js"></script>

   <link rel="stylesheet" type="text/css" media="screen" href="https://burakbayramli.github.io/css/style.css">
  </head>
    <body>
      <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">
            <a href="https://burakbayramli.github.io" style="text-decoration:none; color:inherit;">dersblog</a>
          </h1>
          <h2 id="project_tagline"></h2>          
        </header>
      </div>
      <div id="main_content_wrap" class="outer">        
        <section id="main_content" class="inner">
        <h1></h1>
<h1>Javascript</h1>

<p>Tamamen istemci, tarayıcı üzerinde işleyen kodlara ihtiyaç varsa
Javascript kodlaması yaparız. Javascript kodları HTML içine bile
gömülebilir, ve bu kodlar içinde olduğu HTML öğelerine
erisebilirler. Bu sayede servis tarafında üretilmiş bir HTML
gönderilmiş olsa bile hala o HTML üzerinde değişiklik yapılabilir. Bir
girdi kutusuna girilen bilgi yeni bir liste yaratılmasını sağlayabilir
mesela, her türlü ekleme, çıkarma, düzeltme işlemi kullanıcı tarafında
halledilebilir. </p>

<h3>Geliştirme Ortamı</h3>

<p>Javascript geliştirme her zaman bir uygulama servisi gerektirmeyebilir
sonuçta bir HTML kodlanıyor ve bu kodlar tarayıcıda düz dosya olarak
yüklenebilirler, fakat biz gene de bir tane başlatalım. Python
bilenler için en iyisi Flask, bir <code>static</code> dizini yaratılabilir, ve
düz HTML dosyaları buraya koyulur, ve <code>http://localhost:8080/static/dosya.html</code>
şeklinde erişilebilir.</p>

<p>Javascript ne zaman, nerede yüklenir, nasıl çağrılır? </p>

<p>Sablon olarak bir HTML suna benzeyebilir,</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">).</span><span class="nx">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vs vs vs&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>    
  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;foo()&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;output&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Bu dosyada bir JS fonksiyonunu HTML içine gömdük, bu fonksiyon HTML
yüklenir yüklenmez çağrılacaktır. Fonksiyon <code>foo</code> yu <code>body onload</code>
çengeline takarak bunu yapmış olduk. Çengel derken İngilizce hook
kavramına atıf yapılıyor, yani beni arama ben seni ararım tekniği, biz
çağrılmasını istediğimiz fonksiyonu altyapıya veriyoruz (çengele
takıyoruz), onun ne zaman çağrılacağını biz kontrol etmiyoruz, yeri
gelince altyapı onu çağırıyor.</p>

<p>Kodlamayı direk sayfa içine Javascript gömerek, ya da ayrı bir <code>js</code>
dosyasını sayfaya dahil ederek yapabiliriz. İkinci yöntem kod
idaresi açısından daha rahattır. HTML içine</p>

<pre><code>&lt;script src="funcs.js"&gt;&lt;/script&gt;
</code></pre>

<p>koyunca <code>funcs.js</code> otomatik olarak dahil edilecektir.  Fakat dikkat,
eğer tarayıcı önbelleklemesi (cache) açık ise, ki olağan durum budur,
js dosyasında yapılan değişiklikler HTML tarayıcıda tekrar yüklense
bile etki etmeyebilir, o zaman <code>Developer tools</code>, <code>Network</code> ve oradan
<code>Disable cache</code> seçimi yapılırsa önbelleklenme kapatılmış olur, kod
her seferinde tekrar yüklenir. Tabi Web'de her kullanıcının bunu
yapmasını bekleyemeyiz, o zaman yeni kod sürümü yapacaksak yeni kod
için yeni bir js dosya ismi kullanmak bir çözüm olabilir.</p>

<p>Log</p>

<p>Eğer kod işletimi sırasında bazı değerleri log bırakmak açısından düz metin
olarak basmak istiyorsak, bunu <code>console.log(..)</code> ile yapabiliriz. Çıktıları görmek
için Chrome içinde üst sağ köşede tıklama yapıp <code>More tools</code> ve <code>Developer tools</code>
seçimi yaparız. Bu araç tarayıcının sağ kenarında çıkar, üstteki tab içinde
<code>Console</code> seçimi yaparak log çıktılarını görmek mümkündür. </p>

<p>Bir diğer mesaj basma yöntemi <code>alert</code> çağrısı, fakat bu çağrı bir
diyalog kutusu yaratır, tıklama yapıp kapatmak gerektiği için her
yerde kullanılmıyor.</p>

<p>Node</p>

<p>Görsel kodlamada ilerlemeden önemli bir konuya değinelim, çünkü
ileride JS kodlarını test etmek için faydalı olabilir. Node
teknolojisi ünlü, bu servis tarafında Javascript anlamına geliyor. V8
motoruyla beraber JS kodlarının işletimi hızlandı, ve bazıları da
düşündü ki "ben motoru alıp servis tarafında koştururum, böylece hem
görsel hem servis kodlarını aynı dilde yazabilmiş olurum". Node
buradan çıktı. Biz şu anda servis tarafı kodlamasını işlemiyoruz,
fakat pür istemci için olsa bile bazı Javascript kodları hala görsel
olmayan mantık içerebilir, ve bu kodları ayırıp, node üzerinden test
etmek mümkündür, böylece sürekli tarayıcıyı açmak gerekmez, komut
satırından Javascript test edebiliriz.</p>

<p>Kurmak için,</p>

<pre><code>sudo apt install nodejs
</code></pre>

<p>Simdi mesela bir <code>test1.js</code> icinde</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">));</span>
</code></pre>
</div>

<p>Bu kodu</p>

<pre><code>node test1.js
</code></pre>

<p>ile işletince <code>7</code> değeri basılacaktır. Dikkat edersek görsel kod içinde kullanılan
aynı <code>console.log</code> çağrısı var, ve bu çağrı otomatik olarak komut satırı ekranına
çıktıyı basacağını bildi.</p>

<p>Node kodlarından dosya yüklemek bile mümkün,</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>

<span class="nx">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s2">&quot;/home/user1/dir/dosya.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</code></pre>
</div>

<p>Tabii üstteki kod görsel kodlama için uygun değil çünkü tarayıcı içindeki
Javascript yerel dizindeki dosyalara erisemez, İnternet üzerinden dosya
okumak için <code>XMLHttpRequest</code> gerekir, o konuya geliyoruz, fakat test
amacıyla üstteki çağrı hala faydalıdır.</p>

<p>Sayfa bazında Javascript'in <code>src include</code> ile yüklediği dış kütüphaneleri
Node ile <code>require</code> kullanarak alabiliriz. Mesela [2]'deki matematik kodlarını
kullanmak istiyorum, gerekli <code>math.js</code>  dosyasını indirip</p>

<pre><code>var math = require('./math.js');
let N = 20;
A = math.round(math.random([N,N]),5);
B = math.round(math.random([N,N]),5);

C = math.multiply(A, B);
</code></pre>

<p>gibi bir kod işletebilirim. Üstte lineer cebir matris çarpım işlemi yapmış olduk.</p>

<p>Eğer kendim dahil edilebilir kodlar yazmak istiyorsam, mesela <code>util.js</code> içinde
bir <code>add</code> fonksiyonumun dışarıdan dahil edilebilir olmasını istiyorsam,</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="o">+</span><span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">subtract</span><span class="p">(..,...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="o">-</span><span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">add</span><span class="o">:</span><span class="w"> </span><span class="nx">add</span><span class="p">,</span>
<span class="w">    </span><span class="nx">subtract</span><span class="o">:</span><span class="w"> </span><span class="nx">subtract</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Artık bu modülü üstteki tarif edildiği gibi dahil edip kullanabilirim,</p>

<pre><code>var u = require("./util.js")
u.add(...)
</code></pre>

<h3>Çengeller</h3>

<p>Javascript fonksiyonları her türlü kullanıcı aksiyonu sayesinde çağrılabilir.
Mesela bir URL bağlantısına tıklanınca bir fonksiyon çağrılsın istiyorsak
<code>a href='#' onclick='func2()</code>...`  diyebiliriz. Diğer pek çok çengel noktası
vardır bunlar bir HTML referansından öğrenilebilir.</p>

<h3>Temel Görsel İşlemler</h3>

<p>Javascript içinden HTML sayfasının görsel öğelerine erişilebilir
demiştik, bu öğelerden bilgi alınabilir, ve geri bilgi yazılıp
görüntüde değişim yapılabilir.</p>

<p>HTML içinde <code>id=".."</code> ile işaretlenen etiketlerin, mesela <code>&lt;div&gt;</code>
etiketi olsun, ana objesini kimlik değeri geçerek
<code>document.getElementById(..)</code> ile alabiliriz, sonra bu obje üzerinde
<code>.innerText</code> ile içerik değişimi yapabiliriz. Sadece düz metin değil
HTML de geçmek mümkündür, bunun için <code>.innerHTML</code>.</p>

<p>Eğer bir metin giriş kutusu var ise, kimliği <code>myInput</code> olsun,</p>

<pre><code>&lt;form ..&gt;
   &lt;input id="myInput" type="text" name="myCountry" placeholder="Movie"/&gt;
   &lt;button onclick="func2()"&gt;Ok&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<p>Düğmeye basılınca bir <code>func2()</code> Javascript çağrısı yapılmasını sağlarız, bu
fonksiyon içinden</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">deger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;myInput&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</code></pre>
</div>

<p>ile kutudaki değeri okuyabiliriz.</p>

<h3>Temel Programlama Yapıları, Kapsam</h3>

<p>Değişken tanımlarken onların kapsamını (scope) iyi bilmek lazım, yani
değişken hangi bölgelerde tanımlıdır, bir bölümde set edilince diğer
yerde görünebilir mi, değer alımı yapılabilir mi?</p>

<p>Javascript'in olağan davranışı eğer değişken kapsamı tanımlanmamışsa,
onun her yerde (global) kapsamı olmasıdır. Mesela</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">func1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;in func1&#39;</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="nx">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aaaaaa&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">func2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;in func2&#39;</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">var1</span><span class="p">);</span>
<span class="p">}</span>


<span class="nx">func1</span><span class="p">();</span>

<span class="nx">func2</span><span class="p">();</span>
</code></pre>
</div>

<p>script'i işleyince <code>func1</code> içinde set edilen <code>var1</code> değeri
basılır. Bir fonksiyon içinde tanımlanan değer diğerinde
görülebilmiştir.</p>

<p>Diğer kapsamlar <code>let</code> ve <code>var</code> ile yapılır, bunlardan birincisi
değişkeni içinde olduğu kapsama sınırlar, diğeri içinde olduğu
fonksiyona sınırlar. Mesela üstteki kodda <code>func1</code> içinde <code>let var2 = "bbbbbb"</code>
tanımlasam ve <code>func2</code> içinden erişmeye uğraşsam hata mesajı alırım. </p>

<p>Javascript tiplemesi dinamiktir, yani statik olan C++ gibi dillerin
tersini derleme aşaması yoktur ki bu aşamalarda bazı diller tip
uyuşması şartı arayabiliyor, mesela <code>a == b</code> testi yapıyorsam
derleyici <code>a</code> ve <code>b</code> tiplerinin uyumlu olma şartını isteyebilir. JS
ile derleme süreci yok, hatta işlem anında JS yapabildiği kadar
otomatik değişimi yapmaya uğraşır. Mesela <code>2 == "02"</code> gibi bir eşitlik
kontrolü "doğru" cevabını verecektir, sistem <code>02</code> metin değerini sayı
yapıp <code>2</code> ile karşılaştırmasını gerçekleştirmiştir.</p>

<p>Anahtar bazlı hızlı erişilebilen sözlük (dictionary) yapısı pek çok
diğer dilde olduğu gibi Javascript'te de mevcuttur. Yaratmak için
direk kod içinde</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">}</span>
</code></pre>
</div>

<p>diyebilirdim, erişmek için <code>d1['a']</code> çağrısı 3 değerini verir. Bir
anahtarın sözlükte olup olmadığını kontrol için <code>hasOwnProperty</code>
çağrısı var.</p>

<p>Sözlük değeri olarak bir liste, bir başka sözlük te
kullanabilirdik. Eğer tüm anahtarları gezmek (iterate) istersem,</p>

<div class="codehilite">
<pre><span></span><code><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">d1</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
</div>

<p>Bu anahtarları kullanıp değerleri de alabilirdim muhakkak.</p>

<p>Listeler benzer şekilde direk kod içinde yaratılabilir, bir tane yaratalım,
ve eski usul C vari bir şekilde onu gezelim,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">l1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="p">]</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l1</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">l1</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Listeler de <code>forEach</code> tekniği ile gezilebilir,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">l1</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
</div>

<p>Koşul komutları <code>if</code>, <code>else</code> tahmin edilebilecek şekilde ve C, Java da
olduğu gibi işler.</p>

<p>Metinler (String)</p>

<p>Bir metin yaratmak icin yine direk kod icinde</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bir kelime&quot;</span><span class="p">;</span>
</code></pre>
</div>

<p>diyebilirdik. Kelimeye ekler yapmak arti isareti kullanabilir,</p>

<pre><code>s2 = s1 + " arti bir sey";
</code></pre>

<p>gibi. Kelimeler üzerine Python'dan tanıdık <code>split</code> çağrısı var, mesela</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">s2</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
</code></pre>
</div>

<pre><code>[ 'bir', 'kelime', 'arti', 'bir', 'sey' ]
</code></pre>

<p>Bir metnin diğeri içinde olup olmadığını kontrol için <code>includes</code>, mesela</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;berber&quot;</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;erb&quot;</span><span class="p">));</span>
</code></pre>
</div>

<p>çağrısı <code>true</code> döndürür.</p>

<p>Şablon kullanımı için ilginç bir sözdizimi var, </p>

<div class="codehilite">
<pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;baslik&quot;</span><span class="p">;</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;h2&gt;</span><span class="si">${</span><span class="nx">header</span><span class="si">}</span><span class="sb">&lt;/h2&gt;&lt;ul&gt;`</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</code></pre>
</div>

<p>Bu kodlar ekrana <code>html</code> içindeki değerleri basar ve oradaki
<code>${header}</code> için <code>header</code> değişkeninde görülen değer geçirilir. Yani
<code>html</code> içindeki şablonda bir değer doldurması yapıyoruz, bu doldurma
için geriye tek tırnak (backtick) içinde Javascript'teki değişken
isimlerini kullanabiliyoruz.</p>

<h3>JSON</h3>

<p>Javascript'in dış dünya ile alışverisi en rahat JSON bazlı yapılır, bu
sebeple kullanımını bilmek iyi olur. JSON sonuçta bir sözlük, ya da
listenin metin halidir. Tabii sözluk içinde sözlük, onun içinde liste
gibi istenildiği kadar çetrefil yapılari taşıyabilir bu sebeple
kuvvetli bir temsil şeklidir. Dışarıdan gelen JSON formatındaki metni
Javascript'te görülebilen ona karşılık olan yapılara çevirmek için
<code>JSON.parse</code>, yapıları geri JSON metnine çevirmek için
<code>JSON.stringify</code> kullanılır.</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">json1</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s1">&#39;{ &quot;key1&quot;: &quot;val1&quot;, &quot;key2&quot;: &quot;value2&quot; }&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">json2</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s1">&#39;[2,3,4,5]&#39;</span><span class="p">;</span>

<span class="nx">json1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json1</span><span class="p">);</span>
<span class="nx">json2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json2</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json1</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">]);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json2</span><span class="p">[</span><span class="mf">2</span><span class="p">]);</span>
</code></pre>
</div>

<h3>Çerez (Cookie) Kullanımı</h3>

<p>Çerezler sitelerin kullanıcı tarayıcısına yerel bırakabildiği 'bilgi
kırıntılarıdır', bilgi notlarıdır. Çerezler sayesinde en basit statik
HTML + Javascript bile kullanıcının o siteye özel bazı bilgileri kendi
bilgisayarında depolamasını sağlayabilir. Mesela bir kullanıcı favori
filmlerini seçer, Javascript o bilgiyi alıp bir çereze koyar, sonraki
ziyaretinde kullanıcı (bizim kod üzerinden) o çereze erişir, ve
tarayıcısında o bilgiyi görür. Böylece site tarafından hatırlanmış
olur, bu arayüz tasarımı açısından iyi bir şeydir.</p>

<p>Javascript ile çerezlere erişim basittir, <code>document.cookie</code> ile
kodladığım, kullanıcının ziyaret etmekte olduğu tüm çerezleri
alabilirim, bu degiskene bir değer yazdığımda çerezi değiştirmiş
olurum. Tabi belli bir formatı takip etmek iyidir, metin içinde ilk
başta <code>isim=</code> tanımlarsak o çereze isim vermiş oluyoruz. Sonda bir <code>;</code>
sonrası <code>expires=Wed, 05 Aug 2025 23:00:00 UTC</code> gibi bir tarih vermek
o çereze bir zamanaşımı veriyor, bu zamandan sonra o çerez geçersiz
oluyor, ondan önce hatırlanıyor. Eğer zamanaşımı verilmezse olağan
davranış çerezin silinmesidir.</p>

<p>Bazı çerez kullanım kalıpları şöyle olabilir, siteyi ziyaret edenlerin
çerezi kontrol edilir, <code>document.cookie.length &lt; 1</code> ile, eğer çerez
boş ise, hemen bir çerez atanır. Mesela alışveriş listesi (cart) için</p>

<pre><code>empty = {"cart": {}}
document.cookie = 'bb=' + JSON.stringify(empty) + '; expires=Wed, 05 Aug 2025 23:00:00 UTC';
</code></pre>

<p>Böylece alışveriş için bir sözlük yarattım, onun JSON tanımını bir
zamanaşımı ile çereze koydum. Çerez okurken</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">elems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">);</span>
<span class="nx">movies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">elems</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
</code></pre>
</div>

<p>diyebilirim.</p>

<p>Site Çerezi</p>

<p>Eğer farklı sayfalardan aynı çereze erişilebilsin istiyorsam üstteki
çerez metnine zamanaşımı ibaresinden sonra bir <code>;path=/</code> ifadesi
ekleyebilirim, böylece çerez "site çerezi" haline gelir, ve her sayfa
tüm çereze erisebilir. Benim kendi kullandığım bazı yardımcı
fonksiyonlar alttaki gibidir,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">all_apps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;sayfa1&#39;</span><span class="p">,</span><span class="s1">&#39;sayfa2&#39;</span><span class="p">];</span>

<span class="nx">expires_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;; expires=Wed, 05 Aug 2025 23:00:00 UTC;path=/&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">init_cookies</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">all_apps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">empty</span><span class="p">[</span><span class="nx">app</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;bb=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">empty</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">expires_path</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">elems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">prefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">elems</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span><span class="w">    </span>
<span class="w">    </span><span class="nx">all_apps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="nx">prefs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">app</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">prefs</span><span class="p">[</span><span class="nx">app</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;bb=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">prefs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">expires_path</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">get_prefs</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">elems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">prefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">elems</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">prefs</span><span class="p">;</span><span class="w">   </span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">save_cookie</span><span class="p">(</span><span class="nx">prefs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;bb=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">prefs</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">expires_path</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Her sayfa başlangıcında <code>init_cookies</code> çağrılır, site çerezi ismi
<code>bb</code>, bu çerez içinde <code>all_apps</code> de olan bölümler yoksa hemen eklenir
(böylece yeni sayfa/uygulama ekleyince çerezlere hemen etki eder), ve
her sayfa kendine ait bilgiye bir sözlük üzerinden erişir. Çerezleri
almak için <code>get_prefs</code> geri yazmak için <code>save_cookie</code>.</p>

<h3>Alternatif Depolama Yöntemleri</h3>

<p>Eğer çerez kullanmak istemiyorsak ya da kullanmak mümkün değil ise
(bir keresinde siteme eklediğim reklam servisinin Javascript kodu site
seviyesinde ne çerez bulursa onları siliyordu, uygulamamızın çerezi
yok oluyordu), alternatif depolama yöntemleri vardır. Bunlardan kalıcı
olanı <code>localStorage</code>, oturum bazında olanı <code>sessionStorage</code>.</p>

<p>Her iki değişken her zaman kullanıma hazır durumdadır, ve anahtar /
değer bazında çalışırlar. <code>setItem('anahtar','değer')</code> ile depolama
yapılır, <code>.getİtem('anahtar')</code> ile depolanan değer geri alınır. Eğer
<code>localStorage</code> kullanılmışsa tarayıcı kapatıldıktan sonra bile
değerler sonraki ziyarette hatırlanır, <code>sessionStorage</code> ile oturum
bitince değerler silinir.</p>

<p>Önemli nokta, her iki depolama sisteminin de metin (string) bazlı
depolama yapması, yani çetrefil obje mesela dizin, sözlük gibi
depolayınca onu olduğu gibi geri alabilmeyi bekleyemeyiz, o yüzden her
iki durumda da depolamadan önce <code>JSON.stringify</code> ile metne çevirip,
geri okurken de <code>JSON.parse</code> ile gerekli objelere çevirim yapmamız
gerekir.</p>

<h3>XMLHttpRequest</h3>

<p>Statik Dosya</p>

<p>Uzaktaki bir JSON dosyasını alıp okumak istiyorsak,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://www.filanca.com/dir/file1.json&quot;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">xmlHttp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">);</span><span class="w"> </span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
<span class="p">...</span>
</code></pre>
</div>

<p>Fakat dikkat, eğer üstteki kod <code>filanca.com</code> sitesi dışındaki başka
bir siteden geliyorsa, mesela HTML/JS kodu <code>falanca.com</code>'da
eriştiğimiz json <code>filanca.com</code>'da olabilir, o zaman çoğunlukla bu
erişim CORS denilen bir hata verir, her site dışarıdan gelen kodlara
programsal erişim sağlamak istemiyor. En garanti olan sitenin kendi
servis ettiği json dosyalarına erişmektir, bu da izafi dizin erişimi
ile yapılabilir, mesela <code>filanca.com/dir/index.html</code> içindeki
Javascript aynı dizindeki json dosyasına <code>/dir/file1.json</code> ile erişir.</p>

<p>Önbellekleme</p>

<p>JSON dosyalarına bir kez erişildiğinde bu dosyalara ikinci erişim
onbellekten veriyi alır, bir daha Internet'e gidiş olmaz. Bu hem
programlama hem performans açısından yardımcı olur, farklı sayfalar
aynı json dosyasına erişiyorsa ikinci ve sonraki erişimler hızla
işleyecektir, çetrefil onbellekleme kodlarına gerek kalmaz.</p>

<p>Ajax</p>

<p>XMLHttpRequest ile Ajax çağrısı yapmak ta mümkündür. İlk kez bu
noktada bir pür uygulama servisi özelliği kullanacağız yani işlem
kodlarının servis tarafında olduğu türden, üç katmanlı (three-tier)
mimarinin orta katmanının gerekli olduğu yapı.</p>

<p>Diyelim ki bir taban yarattım (üçüncü katman) ona bir servis arayüzü
üzerinden iletişim vermek istiyorum, <code>get</code> ile geçilen anahtar değeri
tabanda bakılıp döndürülecek, <code>set</code> ile verilen değer ve anahtar
tabana yazılacak.  Servis tarafını Flask ile yazalım,</p>

<div class="codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;ali&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="s2">&quot;veli&quot;</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">():</span>    
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
    <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>    
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/set&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">():</span>    
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
    <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;new db&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">})</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>   
</code></pre>
</div>

<p>HTML/Javascript şöyle olabilir,</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://localhost:8080/set&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">xmlhttp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span><span class="w">   </span><span class="c1">// new HttpRequest instance </span>
<span class="w">    </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;application/json;charset=UTF-8&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="p">}));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://localhost:8080/get&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">300</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">key</span><span class="p">}))</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">//set(&quot;ah&quot;,&quot;ahmet&quot;);</span>
<span class="w">      </span><span class="c1">//get(&quot;a&quot;);</span>
<span class="w">      </span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>


<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;foo()&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>
</div>

<h3>URL Parametresi Okumak</h3>

<p>Servis tarafı kodlarında olduğu gibi pür istemci tarafında işleyen
Javascript kodlarında da URL sonuna eklenen parametreler
okunabilir. Mesela bir ürün programı yazmışsak, ürün listesinden bir
ürüne tıklayınca onun detaylarını ayrı bir <code>detay.html</code> sayfasında
görmek isteyebilirim. Hangi ürüne baktığımı bu sayfaya bir parametre
ile geçmek isterim, mesela <code>id=...</code> gibi. Tüm URL
<code>/detay.html?id=12231</code> gibi bir çağrı olabilir.</p>

<p>Parametreyi URL'den almak için <code>location.search</code> çağrısından tüm URL'i
alırım, ve parametre kısmını ayırırım, bunlar o sayfa yüklenir
yüklenmez işleyen bir Javascript fonksiyonu içinde yapılabilir,</p>

<pre><code>&lt;html&gt;
  &lt;script&gt;
    function detail() {
      var id = location.search.split('id=')[1];
      var s = `Gonderilen urun id ${id}`;
      document.getElementById('output').innerHTML = s; 
    }
  &lt;/script&gt;    
  &lt;body onload='detail()'&gt;
    &lt;div id="output"&gt;
    &lt;/div&gt;
  &lt;/body&gt;

&lt;/html&gt;
</code></pre>

<p><a href="detay.html?id=4444">Örnek</a></p>

<h3>Tarih Objeleri</h3>

<p>Tarih objesi yaratmak için en rahat yöntem,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">dt1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;2022-03-25&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dt1</span><span class="p">);</span>
</code></pre>
</div>

<pre><code>2022-03-25T00:00:00.000Z
</code></pre>

<p>Eğer yıl, ay, gün ayrı ayrı geçmek istersek biraz takla lazım, ay
sıfır indisli, gün değil, alttaki gibi oluyor,</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">dt1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="mf">2022</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">25</span><span class="o">+</span><span class="mf">1</span><span class="p">);</span>
</code></pre>
</div>

<p>Bir tarihe gün ekleyip yeni tarih elde etmek için</p>

<div class="codehilite">
<pre><span></span><code><span class="nb">Date</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">days</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">());</span>
<span class="w">    </span><span class="nx">date</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">days</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">date</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">dt2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dt1</span><span class="p">.</span><span class="nx">addDays</span><span class="p">(</span><span class="mf">20</span><span class="p">);</span>
</code></pre>
</div>

<p>İki tarih arası gün farkı</p>

<div class="codehilite">
<pre><span></span><code><span class="nx">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dt2</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">dt1</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>

<span class="nx">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diff</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1000</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">24</span><span class="p">);</span>
</code></pre>
</div>

<p>Basit bir kronometre kodlaması,</p>

<div class="codehilite">
<pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="c1">// burada bazi islemler...</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Islem zamani: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="p">)</span><span class="err">&quot;</span><span class="p">);</span>
</code></pre>
</div>

<h3>İşlem Sırasında Animasyon Göstermek</h3>

<p>Uzun sürebilecek işlemler sırasında bir anımasyon GİF göstermek mümkündür.
Bir teknik şudur, bir <code>&lt;div&gt;</code> içine koyulmuş bir anımasyon GİF var,
bu <code>&lt;div&gt;</code> sayfa yüklendiğinde stili <code>dışplay: nöne;</code> ile kapalı tutulur,
yani gösterilmez. İşlem için bir düğmeye basıldığında ilk önce stil
<code>block</code> haline getirilir, yani anımasyon gösterilir, işlem bitince
anımasyon yine kapatılır.</p>

<p>Burada tek problem üstte sıralanan tüm işlemlerin aynı iş parçacığı
(thread) içinde olacağı için kapatma/açılma işlemlerinin doğru
gösterilmemesi. Fakat eğer uzun sürecek işlemi başka bir iş parçacığı
içine asenkron olarak işletirsek [3], istenen görüntü elde
edilir. Kullanılan animasyon gif <a href="busy.gif">şurada</a>.</p>

<div class="codehilite">
<pre><span></span><code><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">longLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000000000</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">go</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">spinnerElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;spinner&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">resultElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">spinnerElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;block&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">longLoop</span><span class="p">())</span>
<span class="w">        </span><span class="p">}))</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">spinnerElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span>
<span class="w">          </span><span class="nx">resultElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span><span class="w">   </span>
<span class="w">      </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;go();&quot;</span><span class="p">&gt;</span>Go<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;result&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: none;&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;busy.gif&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">img</span><span class="p">&gt;</span>  
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre>
</div>

<p>Kaynaklar</p>

<p>[2] https://mathjs.org/download.html</p>

<p>[3] https://stackoverflow.com/questions/71943182/how-to-show-hide-animated-gif-during-the-execution-of-a-function/71944178#71944178</p>

          <div id="container-d84f574876e65b2d8f0c7bae784c22b3"></div>

          <br/><a href="../index.html">Yukarı</a>
        </section>          
      </div>
    </body>
</html>
